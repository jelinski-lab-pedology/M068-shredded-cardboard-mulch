---
title: "Soil fertility"
---

## Packages

```{r}
library(tidyr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(here)
library(moments)
library(MASS) #boxcox transformation
library(lme4)         #mixed models
library(lmerTest)     #mixed models
library(broom.mixed)  #mixed models
library(emmeans)
library(FSA)

```

## Loading Data

```{r}
#will also need to add in 
soil_fert <- read.csv(here::here("00-data", "b-prepared", 
                                 "20250530_SCM-soil-fertility.csv"), 
                           header = TRUE)

bd <- read.csv(here::here("00-data", "b-prepared", 
                          "20250718_SCM-BD.csv"), 
                     header = TRUE)

```

## Format Data

```{r}
soil_fert <- soil_fert %>%
             subset(block != 5) %>%
             unite(col = "unique_ID", c("block", "plot"), sep = ".", remove = FALSE) %>%
             mutate(sample_date = lubridate::as_date(sample_date, format = "%m/%d/%Y"),
                    month = lubridate::month(sample_date),
                    year = lubridate::isoyear(ymd(sample_date)),
                    cn_ratio = total_c_wt_pct/total_n_wt_pct) %>%
             mutate_at(c('unique_ID', 'block', 'plot', 'treatment', 'crop', 'year', 'month'), as.factor)

#removing potential outliers
soil_fert_out <- soil_fert

soil_fert$NH4_ppm[soil_fert$sample_date == "2023-05-23" &
                  soil_fert$block == "1" &
                  soil_fert$plot == "A"] <- NA

soil_fert$NO3_ppm[soil_fert$sample_date == "2023-05-23" &
                  soil_fert$block == "1" &
                  soil_fert$plot == "A"] <- NA

start_end <- soil_fert %>%
             subset((month == 5 & year == "2023") | (month == 10 & year == "2024"))


soil_fert_23 <- subset(soil_fert, year == "2023")
soil_fert_24 <- subset(soil_fert, year == "2024")

#Total C both years
bc <- boxcox(lm(soil_fert$total_c_wt_pct ~ 1))
lambda <- bc$x[which.max(bc$y)]
soil_fert$bc_c <- (soil_fert$total_c_wt_pct ^ lambda -1)/lambda

#ammonium 2024 only
bc <- boxcox(lm(soil_fert_24$NH4_ppm ~ 1))
lambda <- bc$x[which.max(bc$y)]
soil_fert_24$bc_NH4 <- (soil_fert_24$NH4_ppm ^ lambda -1)/lambda


bd <- bd %>%
      subset(block != 5) %>%
      mutate(date_collected = lubridate::as_date(date_collected, format = "%m/%d/%Y"),
             year = lubridate::isoyear(ymd(date_collected))) %>%
      mutate_at(c('block', 'plot', 'treatment', 'crop', 'year'), as.factor)

```

## Initial Soil Properties

```{r}

#really just doing this for the initial soil properties, but figured might as well do it for all dates
avg_trt <- soil_fert %>%
                group_by(sample_date, treatment) %>%
                summarize(avg_pH = mean(pH),
                          avg_p_ppm = mean(bray_p_ppm),
                          avg_k_ppm = mean(k_ppm),
                          avg_NO3_ppm = mean(NO3_ppm),
                          avg_NH4_ppm = mean(NH4_ppm),
                          avg_c_pct = mean(total_c_wt_pct),
                          avg_n_pct = mean(total_n_wt_pct)) %>%
                ungroup()

# only for initial soil properties, but easiest to summarize for each date                     
initial_agg <- soil_fert %>%
               group_by(sample_date) %>%
               summarize(avg_pH = mean(pH),
                         avg_p_ppm = mean(bray_p_ppm),
                         avg_k_ppm = mean(k_ppm),
                         avg_NO3_ppm = mean(NO3_ppm),
                         avg_NH4_ppm = mean(NH4_ppm),
                         avg_c_pct = mean(total_c_wt_pct),
                         avg_n_pct = mean(total_n_wt_pct)) %>%
               ungroup()

```

## Phosphorus

In summary, there's a significant difference in soil P between the start and end of the experiment, and between May and October each year. However, there are no significant differences between treatments and/or crops. The only time there is *maybe* as significant difference is between bare soil and straw mulch in October 2024. But if I really do cut off at 0.05, then it's not.

### Visualization

This is the visualization that best reflects the results

```{r}
# P by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = bray_p_ppm, fill = treatment)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = bray_p_ppm, color = treatment)) + geom_point() + geom_smooth(method = lm)

```

```{r}
# P by sample date for each crop-treatment combination
ggplot(soil_fert, aes(x = as.factor(sample_date), y = bray_p_ppm, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(soil_fert, aes(x = sample_date, y = bray_p_ppm, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)


# P by sample date for each crop
ggplot(soil_fert, aes(x = as.factor(sample_date), y = bray_p_ppm, fill = crop)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = bray_p_ppm, color = crop)) + geom_point() + geom_smooth(method = lm)

# P by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = bray_p_ppm)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = bray_p_ppm)) + geom_point() + geom_smooth(method = lm)

# P overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = bray_p_ppm, fill = treatment)) + geom_boxplot()

# P overall for treatment
ggplot(soil_fert, aes(x = treatment, y = bray_p_ppm)) + geom_boxplot()

# P overall for crop
ggplot(soil_fert, aes(x = crop, y = bray_p_ppm)) + geom_boxplot()

# P for 2023 by crop-treatment
ggplot(soil_fert, aes(x = crop, y = bray_p_ppm, fill = treatment)) + geom_boxplot() + facet_wrap(~year)

# P for 2023 by treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = treatment, y = bray_p_ppm)) + geom_boxplot()

# P for 2023 by crop
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = bray_p_ppm)) + geom_boxplot()


# P for 2024 by crop-treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = bray_p_ppm, fill = treatment)) + geom_boxplot()

# P for 2024 by treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = treatment, y = bray_p_ppm)) + geom_boxplot()

# P for 2024 by crop
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = bray_p_ppm)) + geom_boxplot()
```

### ANOVA

#### All data

```{r}

#initial anova shows there is a significant difference between years. diagnostic plots indicate not normally distributed, but KW reinforces it. So, in terms of analyzing treatment and crop, it makes sense to do the years separately (in addition to the change from start to end of the experiment)
aov <- aov(bray_p_ppm ~ treatment*crop*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(bray_p_ppm ~ treatment, data = soil_fert)
kruskal.test(bray_p_ppm ~ crop, data = soil_fert)
kruskal.test(bray_p_ppm ~ year, data = soil_fert)


aov <- aov(bray_p_ppm ~ year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

```

#### Comparing start and end of experiment

```{r}

#ANOVA shows no significant difference between treatments or crops for start and end of the experiment -- but the data also isn't normally distributed
aov <- aov(bray_p_ppm ~ treatment*crop, data = start_end)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#okay, running KW tests, it's clear that there are significant differences between the beginning and end of the experiment. And it's true for all treatments and crops, and the combinations -- but pretty equally true, to be honest? Like that no one treatment or crops has more of an effect than the others
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "BM"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "SM"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "CM"))

kruskal.test(bray_p_ppm ~ year, data = subset(start_end, crop == "AS"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, crop == "DB"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, crop == "FC"))

kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "BM" & crop == "AS"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "BM" & crop == "DB"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "BM" & crop == "FC"))

kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "SM" & crop == "AS"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "SM" & crop == "DB"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "SM" & crop == "FC"))

kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "CM" & crop == "AS"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "CM" & crop == "DB"))
kruskal.test(bray_p_ppm ~ year, data = subset(start_end, treatment == "CM" & crop == "FC"))

```

#### 2023

For the whole year: There is no significant differences in soil P between treatments and crops (or their interactions). Data is normally distributed, and KW tests back up this conclusion.

```{r}
# Looking at the whole year, there is no difference between treatments and crops
aov <- aov(bray_p_ppm ~ treatment*crop, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(bray_p_ppm ~ treatment, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# there is a significant difference between spring and fall, there is not difference for treatments and crops
aov <- aov(bray_p_ppm ~ treatment*crop*month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(bray_p_ppm ~ treatment*month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(bray_p_ppm ~ month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# LMM for the two highest quality models. block is not a significant random effect for either
model <- lmer(bray_p_ppm ~ treatment*month + (1 | block), data = soil_fert_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ month)

model <- lmer(bray_p_ppm ~ month + (1 | block), data = soil_fert_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ month)

# KW tests (not really needed, because the dataset for 2023 is normally distributed). Skipped crops because they already weren't significant

kruskal.test(bray_p_ppm ~ month, data = subset(soil_fert_23, treatment == "BM"))
kruskal.test(bray_p_ppm ~ month, data = subset(soil_fert_23, treatment == "CM"))
kruskal.test(bray_p_ppm ~ month, data = subset(soil_fert_23, treatment == "SM"))


```

Individual sampling events: ANOVA shows no difference between crops or treatments for each sampling event --- but data is not normally distributed for October. If I run KW tests, in May, there is almost a significant difference between treatments for collards (0.05). I will probably not count this to be honest. In October, KW tests show no significant difference for treatment or crop

```{r}
#Sampling #1
aov <- aov(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "5"))

kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "AS"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "DB"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "FC"))
dunnTest(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "FC"))

#LMM: block is not a significant RE 
model <- lmer(bray_p_ppm ~ treatment + (1 | block), data = subset(soil_fert_23, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

```{r}

#Sampling # 2
aov <- aov(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "10"))
kruskal.test(bray_p_ppm ~ crop, data = subset(soil_fert_23, month == "10"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "AS"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "DB"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "FC"))

#LMM: block is a significant random effect
model <- lmer(bray_p_ppm ~ treatment + (1 | block), data = subset(soil_fert_23, month == "10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

#### 2024

For the whole year: There is no significant differences in soil P between treatments and crops (or their interactions). Data is not normally distributed, so ran KW tests, which back up this conclusion.

```{r}
# ANOVA
aov <- aov(bray_p_ppm ~ treatment*crop, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(bray_p_ppm ~ treatment, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(bray_p_ppm ~ treatment*month, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: no differences between treatment, differences between months within each treatment
kruskal.test(bray_p_ppm ~ treatment, data = soil_fert_24)

kruskal.test(bray_p_ppm ~ month, data = subset(soil_fert_24, treatment == "BM"))
kruskal.test(bray_p_ppm ~ month, data = subset(soil_fert_24, treatment == "CM"))
kruskal.test(bray_p_ppm ~ month, data = subset(soil_fert_24, treatment == "SM"))

kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, crop == "AS"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, crop == "DB"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, crop == "FC"))

#LMM: block is not a significant random effect
model <- lmer(bray_p_ppm ~ treatment*month + (1 | block), data = soil_fert_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

ANOVAs indicates that there's no difference between crop or treatments in May, but there is between BM and SM in October (which is probably where the overall year result is coming from). Saying that, if I run KW tests, there is no significant difference between treatments (BM-SM is 0.05) and I actually trust that more.

```{r}
#Sampling #3
#ANOVA
aov <- aov(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "5"))
kruskal.test(bray_p_ppm ~ crop, data = subset(soil_fert_24, month == "5"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "AS"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "DB"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(bray_p_ppm ~ treatment + (1 | block), data = subset(soil_fert_24, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

```{r}
#Sampling # 4
aov <- aov(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW 
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "10"))
dunnTest(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "10"))
kruskal.test(bray_p_ppm ~ crop, data = subset(soil_fert_24, month == "10"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "AS"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))
kruskal.test(bray_p_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "FC"))

#LMM
model <- lmer(bray_p_ppm ~ treatment + (1 | block), data = subset(soil_fert_24, month == "10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```


## Potassium

OKAY, while there is a significant difference between collards and strawberries/beans in 2024, the question I was actually interested in here was whether there was a difference between years, and there is not. When I check the descriptive statistics, the range is basically the same and, more importantly, the mean and sd are nearly the same when I summarize just by year. When I summarize by year and crop, that's where AS is clearly lower in 2024 and has a much smaller sd, but the crops...moved? So this could be an effect from the previous year. Anywho, I think what I feel comfortable with, because the means are so close, is calling this an artifact and just presenting soil K information in the initial soil data table

```{r}
soil_fert %>% group_by(year) %>% summarize(min = min(k_ppm, na.rm = TRUE),
                                           median = median(k_ppm, na.rm = TRUE),
                                           mean = mean(k_ppm, na.rm = TRUE),
                                           max = max(k_ppm, na.rm = TRUE),
                                           sd = sd(k_ppm, na.rm = TRUE))

soil_fert %>% group_by(year, crop) %>% summarize(min = min(k_ppm, na.rm = TRUE),
                                                 median = median(k_ppm, na.rm = TRUE),
                                                 mean = mean(k_ppm, na.rm = TRUE),
                                                 max = max(k_ppm, na.rm = TRUE),
                                                 sd = sd(k_ppm, na.rm = TRUE))

```

### Visualization

The graph that most represents the results:

```{r}
# K overall for crop
ggplot(soil_fert, aes(x = crop, y = k_ppm)) + geom_boxplot()

```

This figure breaks it down by treatment and crop, for consistency, but fundamentally shows the same thing

```{r}
# K overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = k_ppm, fill = treatment)) + geom_boxplot()

```

```{r}
# K by sample date for each crop-treatment combination
ggplot(soil_fert, aes(x = as.factor(sample_date), y = k_ppm, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(soil_fert, aes(x = sample_date, y = k_ppm, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)

# K by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = k_ppm, fill = treatment)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = k_ppm, color = treatment)) + geom_point() + geom_smooth(method = lm)

# K by sample date for each crop
ggplot(soil_fert, aes(x = as.factor(sample_date), y = k_ppm, fill = crop)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = k_ppm, color = crop)) + geom_point() + geom_smooth(method = lm)

# K by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = k_ppm)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = k_ppm)) + geom_point() + geom_smooth(method = lm)

# K overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = k_ppm, fill = treatment)) + geom_boxplot()

# K overall for treatment
ggplot(soil_fert, aes(x = treatment, y = k_ppm)) + geom_boxplot()

```


### ANOVA

```{r}
# when I look at start and end together, there is a significant difference in soil K between crops which was...unexpected
aov <- aov(k_ppm ~ treatment*crop*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)

# There are no significant differences between years for any treatment or crop 
aov <- aov(k_ppm ~ year, data = subset(soil_fert, treatment == "BM"))
summary(aov)

aov <- aov(k_ppm ~ year, data = subset(soil_fert, treatment == "SM"))
summary(aov)

aov <- aov(k_ppm ~ year, data = subset(soil_fert, treatment == "CM"))
summary(aov)

aov <- aov(k_ppm ~ year, data = subset(soil_fert, crop == "AS"))
summary(aov)

aov <- aov(k_ppm ~ year, data = subset(soil_fert, crop == "DB"))
summary(aov)

aov <- aov(k_ppm ~ year, data = subset(soil_fert, crop == "FC"))
summary(aov)

## 2023: no significant differences in soil K for any treatment or crop
aov <- aov(k_ppm ~ treatment*crop, data = subset(soil_fert, year == "2023"))
summary(aov)
TukeyHSD(aov)
AIC(aov)

# 2024: there is a significant difference between FC and AS, but not between treatments
aov <- aov(k_ppm ~ treatment*crop, data = subset(soil_fert, year == "2024"))
summary(aov)
TukeyHSD(aov)
AIC(aov)

# 2024, more: within a treatment, there's not a significant difference between crops
aov <- aov(k_ppm ~ crop, data = subset(soil_fert, year == "2024" & treatment == "BM"))
summary(aov)
TukeyHSD(aov)
AIC(aov)

aov <- aov(k_ppm ~ crop, data = subset(soil_fert, year == "2024" & treatment == "SM"))
summary(aov)
TukeyHSD(aov)
AIC(aov)

aov <- aov(k_ppm ~ crop, data = subset(soil_fert, year == "2024" & treatment == "CM"))
summary(aov)
TukeyHSD(aov)
AIC(aov)

# trying something with unique plots
aov <- aov(k_ppm ~ unique_ID, data = subset(soil_fert, block == 4))
summary(aov)
TukeyHSD(aov)
AIC(aov)

```

### Linear Mixed Model

This shows that if you take block and/or unique ID into consideration, then FC is significantly different than both AS and DB (over both years, as is the current code, but also for 2024 specifically)

RE - AIC block - 716 unique ID - 713 block/unique ID - 712

```{r}
model <- lmer(k_ppm ~ crop + (1 | block), data = soil_fert)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ crop)

```

## Carbon

### Total Carbon

#### Visualization

These are the ones that best reflect the analysis

```{r}
# C by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_c_wt_pct, fill = treatment)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_c_wt_pct, color = treatment)) + geom_point() + geom_smooth(method = lm)

# C by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_c_wt_pct)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_c_wt_pct)) + geom_point() + geom_smooth(method = lm)

```

```{r}
# C by sample date for each crop-treatment combination
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_c_wt_pct, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(soil_fert, aes(x = sample_date, y = total_c_wt_pct, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)

# C by sample date for each crop
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_c_wt_pct, fill = crop)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_c_wt_pct, color = crop)) + geom_point() + geom_smooth(method = lm)

# C overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = total_c_wt_pct, fill = treatment)) + geom_boxplot()

# C overall for treatment
ggplot(soil_fert, aes(x = treatment, y = total_c_wt_pct)) + geom_boxplot()

# C overall for crop
ggplot(soil_fert, aes(x = crop, y = total_c_wt_pct)) + geom_boxplot()

# C for 2023 by crop-treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = total_c_wt_pct, fill = treatment)) + geom_boxplot()

# C for 2023 by treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = treatment, y = total_c_wt_pct)) + geom_boxplot()

# C for 2023 by crop
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = total_c_wt_pct)) + geom_boxplot()


# C for 2024 by crop-treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = total_c_wt_pct, fill = treatment)) + geom_boxplot()

# C for 2024 by treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = treatment, y = total_c_wt_pct)) + geom_boxplot()

# C for 2024 by crop
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = total_c_wt_pct)) + geom_boxplot()

```

#### Overall

```{r}

#overall, there doesn't seem to be a significant difference in C between years, crops, or treatments
aov <- aov(bc_c ~ treatment*crop*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ treatment*crop*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# trying without crop
aov <- aov(bc_c ~ treatment*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ treatment*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#trying for just treatment
aov <- aov(bc_c ~ treatment, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ treatment, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#and finally, trying for just year
aov <- aov(bc_c ~ year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# KW
kruskal.test(total_c_wt_pct ~ treatment, data = soil_fert)
kruskal.test(total_c_wt_pct ~ year, data = soil_fert)

# LMM for top two models: block is a significant random effect

model <- lmer(total_c_wt_pct ~ treatment + (1 | block), data = soil_fert)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)


model <- lmer(total_c_wt_pct ~ year + (1 | block), data = soil_fert)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ year)

```

Comparing the start and end of the experiment

```{r}
#ANOVA shows a significant difference between the start and end of the experiment, but that's across the board, not for a specific treatment/crop. The data doesn't appear to as normally distributed (LMM is...okay for this)
aov <- aov(bc_c ~ treatment*year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ treatment*year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#LMM for the top model. block is a significant random effect
model <- lmer(total_c_wt_pct ~ year + (1 | block), data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ year)

# And just out of curiousity, I tried a different approach, which was calculating the change in C and seeing if there was a treatment effect, and there is not
start_end_c <- soil_fert %>%
               subset((month == "5" & year == "2023") | (month == "10" & year == "2024")) %>%
               mutate(year = ifelse(year == "2023", "initial", "final")) %>%
               dplyr::select(c(block, plot, treatment, total_c_wt_pct, year)) %>%
               pivot_wider(names_from = 'year', values_from = "total_c_wt_pct") %>%
               mutate(change = final - initial)

hist(start_end_c$change)
skewness(start_end_c$change, na.rm = TRUE)
qqnorm(start_end_c$change, main='Normal')
qqline(start_end_c$change)
shapiro.test(start_end_c$change)

aov <- aov(change ~ treatment, data = start_end_c)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

```

#### 2023

For the whole year: There is no significant differences in C between treatments and crops (or their interactions). Data is normally distributed, and KW tests back up this conclusion.

```{r}
#ANOVA
aov <- aov(total_c_wt_pct ~ treatment*crop, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ treatment, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ treatment, data = soil_fert_23)
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, crop == "AS"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, crop == "DB"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, crop == "FC"))

#LMM: block is a significant random effect 
model <- lmer(total_c_wt_pct ~ treatment + (1 | block), data = soil_fert_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

Comparing spring to fall, there is a significant difference -- but no interactions with treatment. When I limit to individual treatments (as KW, because the datasets get non-parametric), then there is an almost significant difference between months for BM specifically, but not SM or CM. Data is normally distributed

```{r}
# there is a significant difference between spring and fall, there is not difference for treatments and crops
aov <- aov(total_c_wt_pct ~ treatment*month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ month, data = soil_fert_23)
kruskal.test(total_c_wt_pct ~ month, data = subset(soil_fert_23, treatment == "BM"))
kruskal.test(total_c_wt_pct ~ month, data = subset(soil_fert_23, treatment == "SM"))
kruskal.test(total_c_wt_pct ~ month, data = subset(soil_fert_23, treatment == "CM"))

#LMM: block is a significant RE
model <- lmer(total_c_wt_pct ~ month + (1 | block), data = soil_fert_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ month)
```

Individual sampling events: ANOVA shows no difference between crops or treatments for each sampling event. Ran KW tests for May, though the data looked normally distributed. Ran KW tests for October because the data is non-parametric. Both back up no significant difference between treatments

```{r}
#Sampling #1
#ANOVA
aov <- aov(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5"))
kruskal.test(total_c_wt_pct ~ crop, data = subset(soil_fert_23, month == "5"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "AS"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "DB"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(total_c_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_23, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```


```{r}

#Sampling # 2
aov <- aov(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10" ))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "AS"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "DB"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(total_c_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_23, month == "10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

#### 2024

For the whole year: There is no significant differences in C between treatments and crops (or their interactions).

```{r}
#ANOVA
aov <- aov(total_c_wt_pct ~ treatment, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, year == "2024"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, crop == "AS"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, crop == "DB"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, crop == "FC"))

#LMM: block is not a significant RE
model <- lmer(total_c_wt_pct ~ treatment + (1 | block), data = soil_fert_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)


```

Comparing spring to fall, there is a significant difference.

```{r}
# there is a significant difference between spring and fall, there is not difference for treatments and crops
aov <- aov(total_c_wt_pct ~ treatment*month, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_c_wt_pct ~ month, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ month, data = soil_fert_24)
kruskal.test(total_c_wt_pct ~ month, data = subset(soil_fert_24, treatment == "BM"))
kruskal.test(total_c_wt_pct ~ month, data = subset(soil_fert_24, treatment == "SM"))
kruskal.test(total_c_wt_pct ~ month, data = subset(soil_fert_24, treatment == "CM"))

#LMM: block is a significant RE
model <- lmer(total_c_wt_pct ~ month + (1 | block), data = soil_fert_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ month)


```

ANOVAs indicates that there's no difference between crop or treatments in May or October. Noting that I can likely use the original dataset occasionally.

```{r}
#Sampling #3
#ANOVA
aov <- aov(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "AS"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "DB"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(total_c_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_24, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```


```{r}

#Sampling # 4
aov <- aov(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10" ))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "AS"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))
kruskal.test(total_c_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "FC"))

#LMM: block is not a significant RE
model <- lmer(total_c_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_24, month == "10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

### Bulk Density

BD in 2024 is significantly higher than 2023; this trend is the same for all mulch treatments. The BD for bare soil trends slightly higher than for mulch treatments. I'm not considering crop, because for soil properties, since we rotated crops, it feels a little weird.

#### Visualization

This is the most relevant visualization for the analysis

```{r}
# BD by sample date - the only significant result
ggplot(bd, aes(x = as.factor(year), y = bulk_density)) + geom_boxplot() 

ggplot(bd, aes(x = year, y = bulk_density)) + geom_point() + geom_smooth(method = lm)

# BD by sample date for each treatment - the main thing we're actually interested in
ggplot(bd, aes(x = as.factor(year), y = bulk_density, fill = treatment)) + geom_boxplot() 

ggplot(bd, aes(x = year, y = bulk_density, color = treatment)) + geom_point() + geom_smooth(method = lm)

#test <- bd %>% group_by(year) %>% summarize(mean = mean(bulk_density))

```

```{r}
# BD by sample date for each crop-treatment combination
ggplot(bd, aes(x = as.factor(year), y = bulk_density, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(bd, aes(x = year, y = bulk_density, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)

# BD by sample date for each crop
ggplot(bd, aes(x = as.factor(year), y = bulk_density, fill = crop)) + geom_boxplot() 

ggplot(bd, aes(x = year, y = bulk_density, color = crop)) + geom_point() + geom_smooth(method = lm)

# BD overall for crop-treatment
ggplot(bd, aes(x = crop, y = bulk_density, fill = treatment)) + geom_boxplot()

# BD overall for treatment
ggplot(bd, aes(x = treatment, y = bulk_density)) + geom_boxplot()

# BD overall for crop
ggplot(bd, aes(x = crop, y = bulk_density)) + geom_boxplot()


```

#### Overall

```{r}

#there is a significant difference between years, and between DB and AS. but no interactions
aov <- aov(bulk_density ~ treatment*crop*year, data = bd)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# trying without crop
aov <- aov(bulk_density ~ treatment*year, data = bd)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#trying without treatment

aov <- aov(bulk_density ~ crop*year, data = bd)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#trying with just year (so far this is the simplest, highest quality model). As a note, also tried crop and treatment as single fixed effects, but both had non-parametric diagnostic plots

aov <- aov(bulk_density ~ year, data = bd)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


#there is a significant different between study years, but not between treatments and crops
kruskal.test(bulk_density ~ treatment, data = bd)
kruskal.test(bulk_density ~ crop, data = bd)

kruskal.test(bulk_density ~ year, data = bd)
kruskal.test(bulk_density ~ year, data = subset(bd, treatment == "BM"))
kruskal.test(bulk_density ~ year, data = subset(bd, treatment == "SM"))
kruskal.test(bulk_density ~ year, data = subset(bd, treatment == "CM"))

#LMM for the top model: block is not a significant RE
model <- lmer(bulk_density ~ year + (1 | block), data = bd)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ year)
```

#### 2023
```{r}
aov <- aov(bulk_density ~ treatment*crop, data = subset(bd, year == "2023"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# these two are tied for highest quality model
aov <- aov(bulk_density ~ treatment, data = subset(bd, year == "2023"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(bulk_density ~ crop, data = subset(bd, year == "2023"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is not a significant difference between treatments or crops in 2023, nor is there a difference between crops within treatments
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2023"))
kruskal.test(bulk_density ~ crop, data = subset(bd, year == "2023"))
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2023" & crop == "AS"))
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2023" & crop == "DB"))
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2023" & crop == "FC"))

#LMM for the top model: block is not a significant RE
model <- lmer(bulk_density ~ treatment + (1 | block), data = subset(bd, year == "2023"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

#### 2024
```{r}
# there's a difference between bare soil and cardboard mulch, and between strawberries and beans, and an interaction effect
aov <- aov(bulk_density ~ treatment*crop, data = subset(bd, year == "2024"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# but here, there's no differences between treatments
aov <- aov(bulk_density ~ treatment, data = subset(bd, year == "2024"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# and there is a nearly/barely significant difference between AS/DB
aov <- aov(bulk_density ~ crop, data = subset(bd, year == "2024"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is not a significant difference between treatments or crops in 2024, nor is there a difference between crops within treatments
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2024"))
kruskal.test(bulk_density ~ crop, data = subset(bd, year == "2024"))
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2024" & crop == "AS"))
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2024" & crop == "DB"))
kruskal.test(bulk_density ~ treatment, data = subset(bd, year == "2024" & crop == "FC"))

#LMM for the top model: block is not a significant RE
model <- lmer(bulk_density ~ treatment + (1 | block), data = subset(bd, year == "2024"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

## Nitrogen

### Nitrate

#### Visualization

Probably the most relevant visualizations:

```{r}
# NO3 by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NO3_ppm, fill = treatment)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(soil_fert, aes(x = sample_date, y = NO3_ppm, color = treatment)) + geom_point() + geom_smooth(method = lm)


```

```{r}
# NO3 by sample date for each crop-treatment combination
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NO3_ppm, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(soil_fert, aes(x = sample_date, y = NO3_ppm, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)


# NO3 by sample date for each crop
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NO3_ppm, fill = crop)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = NO3_ppm, color = crop)) + geom_point() + geom_smooth(method = lm)

# NO3 by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NO3_ppm)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = NO3_ppm)) + geom_point() + geom_smooth(method = lm)

# NO3 overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = NO3_ppm, fill = treatment)) + geom_boxplot()

# NO3 overall for treatment
ggplot(soil_fert, aes(x = treatment, y = NO3_ppm)) + geom_boxplot()

# NO3 overall for crop
ggplot(soil_fert, aes(x = crop, y = NO3_ppm)) + geom_boxplot()

# NO3 for 2023 by crop-treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = NO3_ppm, fill = treatment)) + geom_boxplot()

# NO3 for 2023 by treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = treatment, y = NO3_ppm)) + geom_boxplot()

# NO3 for 2023 by crop
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = NO3_ppm)) + geom_boxplot()


# NO3 for 2024 by crop-treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = NO3_ppm, fill = treatment)) + geom_boxplot()

# NO3 for 2024 by treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = treatment, y = NO3_ppm)) + geom_boxplot()

# NO3 for 2024 by crop
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = NO3_ppm)) + geom_boxplot()

```

#### Overall

```{r}
# ANOVA: I tried treatment*crop*year, treatment*crop, treatment*year, treatment, year, treatment*crop*sample date, treament*sample_date, and sample_date  but none were normally distributed
aov <- aov(NO3_ppm ~ treatment*as.factor(sample_date), data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)
```

```{r}

#there is a significant different between study years, but not between treatments and crops. 
kruskal.test(NO3_ppm ~ treatment, data = soil_fert)
kruskal.test(NO3_ppm ~ crop, data = soil_fert)

kruskal.test(NO3_ppm ~ year, data = soil_fert)
kruskal.test(NO3_ppm ~ year, data = subset(soil_fert, treatment == "BM"))
kruskal.test(NO3_ppm ~ year, data = subset(soil_fert, treatment == "SM"))
kruskal.test(NO3_ppm ~ year, data = subset(soil_fert, treatment == "CM"))

# For all nitrate samples, there is a significant difference between many dates (but not all)
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = soil_fert)
dunnTest(NO3_ppm ~ as.factor(sample_date), data = soil_fert)

# There is a signifcant difference between many dates (but not all)
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "BM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "BM"))

# There is a signifcant difference between many dates (but not all)
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "SM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "SM"))

# There is a signifcant difference between many dates (but not all)
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "CM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "CM"))

```

#### 2023

```{r}
# not a normal distribution
aov <- aov(NO3_ppm ~ treatment, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is not a significant difference between treatments or crops in 2023, nor is there a difference between crops within treatments
kruskal.test(NO3_ppm ~ treatment, data = soil_fert_23)
kruskal.test(NO3_ppm ~ crop, data = soil_fert_23)
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, crop == "FC"))

```

Comparing the sample dates, overall, there is a significant difference between 7/19 and october. Individual treatments have slightly different relationships

```{r}
# not a normal distribution
aov <- aov(NO3_ppm ~ as.factor(sample_date), data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#Bare soil: there is a significant difference between 5/23 and all other dates. 7/5 is not significantly different from 7/19, but is from 10/2. 7/19 is not significantly different from 10/2
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = soil_fert_23)
dunnTest(NO3_ppm ~ as.factor(sample_date), data = soil_fert_23)

# Bare soil:
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "BM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "BM"))

# Straw: All dates are significantly different from each other, except for 7/19 and 10/2 
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "SM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "SM"))

# Cardboard: there is a significant difference between 5/23 and all other dates. There is not a significant difference between other dates.
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "CM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "CM"))

```

Individual sampling events: things get weird and complex in here

```{r}
#Sampling #1: normal distribution
aov <- aov(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "5"))
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_23, month == "5"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(NO3_ppm ~ treatment + (1 | block), data = subset(soil_fert_23, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```


```{r}
#Sampling #2: not a normal distribution
aov <- aov(NO3_ppm ~ treatment*crop, data = subset(soil_fert_23, sample_date == "2023-07-05"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# The only significant difference is between cardboard and straw for collards
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05"))
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-05"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-05"))

kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05" & crop == "DB"))


kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05" & crop == "FC"))
dunnTest(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05" & crop == "FC"))
```

```{r}
#Sampling #3: 
#ANOVA: not normally distributed
aov <- aov(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19"))
dunnTest(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19"))

#There are differences between crops, but I'm ignoring it because what I'm interested in is the treatment
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19"))

kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19" & crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19" & crop == "FC"))

# there's consistently a difference between strawberries and beans under each mulch treatment, though.
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19" & treatment == "BM"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19" & treatment == "BM"))

kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19" & treatment == "SM"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19" & treatment == "SM"))

kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19" & treatment == "CM"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19" & treatment == "CM"))

```

```{r}
#Sampling # 4: not a normal distribution. 
aov <- aov(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "10"))
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_23, month == "10"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "FC"))

```

#### 2024

```{r}
# not a normal distribution
aov <- aov(NO3_ppm ~ treatment, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


#there is not a significant difference between treatments or crops, nor is there a difference between crops within treatments
kruskal.test(NO3_ppm ~ treatment, data = soil_fert_24)
kruskal.test(NO3_ppm ~ crop, data = soil_fert_24)
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, crop == "FC"))

```

Comparing the sample dates, overall, there is a significant difference between 5/23 and all other sampling dates.

```{r}
# non-parametric distribution. 
aov <- aov(NO3_ppm ~ as.factor(sample_date), data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NO3_ppm ~ as.factor(sample_date), data = soil_fert_24)
dunnTest(NO3_ppm ~ as.factor(sample_date), data = soil_fert_24)

#Bare soil: 5/23 is significantly different from all other dates
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "BM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "BM"))

# Straw: 5/23 is significantly different from all other dates 
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "SM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "SM"))

# Cardboard: 5/23 is significantly different from all other dates
kruskal.test(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "CM"))
dunnTest(NO3_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "CM"))

```

Individual sampling events: there's no significant difference between crops until 7/10, and not until october for treatment

```{r}
#Sampling #1: normal distribution for treatment alone. non-parametric distribution for treatment*crop. no significant difference between treatments either way
aov <- aov(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "5"))
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_24, month == "5"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "FC"))

#LMM: not a normal distribution
model <- lmer(NO3_ppm ~ treatment + (1 | block), data = subset(soil_fert_24, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

```{r}
#Sampling #2: not a normal distribution
aov <- aov(NO3_ppm ~ treatment*crop, data = subset(soil_fert_24, sample_date == "2024-06-20"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20"))
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-06-20"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20" & crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20" & crop == "FC"))
```

```{r}

#Sampling #3: mostly normal distribution. If ANOVA for treatment alone, no significant difference. If for treatment*crop, then FC significantly different from DB/AS in ANOVA, only with DB in KW.
aov <- aov(NO3_ppm ~ treatment*crop, data = subset(soil_fert_24, sample_date == "2024-07-10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10"))

# there is a significant difference between DB and FC
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10"))

#there's not a significant difference between mulches within each crop
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10" & crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10" & crop == "FC"))


kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10" & treatment == "BM"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10" & treatment == "BM"))

#differences between AS and FC within straw
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10" & treatment == "SM"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10" & treatment == "SM"))

kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10" & treatment == "CM"))
dunnTest(NO3_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10" & treatment == "CM"))
```

```{r}
#Sampling # 4: not normally distributed
aov <- aov(NO3_ppm ~ treatment*crop, data = subset(soil_fert_24, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# it appears that the ANOVA finding is mostly coming from a difference between BM and CM for DB
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "10"))
kruskal.test(NO3_ppm ~ crop, data = subset(soil_fert_24, month == "10"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "AS"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))
dunnTest(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))
kruskal.test(NO3_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "FC"))

```

### Ammonium

#### Visualization

```{r}
# NH4 by sample date for each crop-treatment combination
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NH4_ppm, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(soil_fert, aes(x = sample_date, y = NH4_ppm, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)

# NH4 by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NH4_ppm, fill = treatment)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = NH4_ppm, color = treatment)) + geom_point() + geom_smooth(method = lm)

# NH4 by sample date for each crop
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NH4_ppm, fill = crop)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = NH4_ppm, color = crop)) + geom_point() + geom_smooth(method = lm)

# NH4 by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = NH4_ppm)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = NH4_ppm)) + geom_point() + geom_smooth(method = lm)

# NH4 overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = NH4_ppm, fill = treatment)) + geom_boxplot()

# NH4 overall for treatment
ggplot(soil_fert, aes(x = treatment, y = NH4_ppm)) + geom_boxplot()

# NH4 overall for crop
ggplot(soil_fert, aes(x = crop, y = NH4_ppm)) + geom_boxplot()

# NH4 for 2023 by crop-treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = NH4_ppm, fill = treatment)) + geom_boxplot()

# NH4 for 2023 by treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = treatment, y = NH4_ppm)) + geom_boxplot()

# NH4 for 2023 by crop
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = NH4_ppm)) + geom_boxplot()


# NH4 for 2024 by crop-treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = NH4_ppm, fill = treatment)) + geom_boxplot()

# NH4 for 2024 by treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = treatment, y = NH4_ppm)) + geom_boxplot()

# NH4 for 2024 by crop
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = NH4_ppm)) + geom_boxplot()

```

#### Overall

```{r}
# I tried treatment*crop*year, treatment*year, crop*year, year, treatment*crop, treatment, crop, and several iterations of sample_date with those, and all were non-parametric   
aov <- aov(NH4_ppm ~ treatment*as.factor(sample_date), data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is nearly a significant difference between SM and BM/CM 
kruskal.test(NH4_ppm ~ treatment, data = soil_fert)
dunnTest(NH4_ppm ~ treatment, data = soil_fert)

kruskal.test(NH4_ppm ~ crop, data = soil_fert)

#there is a significant difference between years, specifically for bare soil
kruskal.test(NH4_ppm ~ year, data = soil_fert)
kruskal.test(NH4_ppm ~ year, data = subset(soil_fert, treatment == "BM"))
kruskal.test(NH4_ppm ~ year, data = subset(soil_fert, treatment == "SM"))
kruskal.test(NH4_ppm ~ year, data = subset(soil_fert, treatment == "CM"))
```


```{r}
# For all ammonium samples, there is a significant difference between many dates (but not all)
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = soil_fert)
dunnTest(NH4_ppm ~ as.factor(sample_date), data = soil_fert)

# There is a signifcant difference between many dates (but not all)
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "BM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "BM"))

# There is a signifcant difference between many dates (but not all)
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "SM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "SM"))

# There is a signifcant difference between many dates (but not all)
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "CM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert, treatment == "CM"))
```

#### 2023

No significant differences across the whole year

```{r}
# not a normal distribution
aov <- aov(NH4_ppm ~ treatment, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


#there is not a significant difference between treatments or crops in 2023, nor is there a difference between crops within treatments
kruskal.test(NH4_ppm ~ treatment, data =soil_fert_23)
kruskal.test(NH4_ppm ~ crop, data = soil_fert_23)
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, crop == "FC"))

```

Comparing the sample dates,

```{r}
# not a normal distribution
aov <- aov(NH4_ppm ~ as.factor(sample_date), data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


kruskal.test(NH4_ppm ~ as.factor(sample_date), data = soil_fert_23)
dunnTest(NH4_ppm ~ as.factor(sample_date), data = soil_fert_23)

#Bare soil: there are significant differences between dates
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "BM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "BM"))

# Straw: there are significant differences between dates 
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "SM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "SM"))

# Cardboard: there are significant differences between dates
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "CM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_23, treatment == "CM"))

```

Individual sampling events: no significant differences

```{r}
#Sampling #1: mostly normal distribution. no significant differences between treatments or crops
aov <- aov(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "5"))
kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_23, month == "5"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "FC"))

#LMM: isSingular
model <- lmer(NH4_ppm ~ treatment + (1 | block), data = subset(soil_fert_23, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

```{r}
#Sampling #2: mostly normal distribution with a couple outliers. no significant differences
aov <- aov(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05"))
kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-05"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05" & crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-05" & crop == "FC"))

#LMM: block is not a significant RE
model <- lmer(NH4_ppm ~ treatment + (1 | block), data = subset(soil_fert_23, sample_date == "2023-07-05"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

```{r}

#Sampling #3: not a normal distribution
aov <- aov(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19"))
kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_23, sample_date == "2023-07-19"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19" & crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, sample_date == "2023-07-19" & crop == "FC"))

```

```{r}

#Sampling # 4: not a normal distribution
aov <- aov(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "10"))
kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_23, month == "10"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "FC"))

```

#### 2024

```{r}
# not a normal distribution. significant difference between bare soil and mulches
aov <- aov(bc_NH4 ~ treatment*as.factor(sample_date), data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


#significant difference between bare soil and mulches overall. For AS, difference between BM and CM
kruskal.test(NH4_ppm ~ treatment, data = soil_fert_24)
dunnTest(NH4_ppm ~ treatment, data = soil_fert_24)

kruskal.test(NH4_ppm ~ crop, data = soil_fert_24)
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, crop == "AS"))
dunnTest(NH4_ppm ~ treatment, data = subset(soil_fert_24, crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, crop == "FC"))
dunnTest(NH4_ppm ~ treatment, data = subset(soil_fert_24, crop == "FC"))

#LMM: sample date is a significant RE
model <- lmer(bc_NH4 ~ treatment + (1 | sample_date), data = soil_fert_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)


```

Comparing the sample dates,

```{r}


#Bare soil: no significant differences between dates
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "BM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "BM"))

# Straw: no significant differences between dates
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "SM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "SM"))

# Cardboard: no significant differences between dates
kruskal.test(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "CM"))
dunnTest(NH4_ppm ~ as.factor(sample_date), data = subset(soil_fert_24, treatment == "CM"))

```

Individual sampling events: only significant differences for June

```{r}
#Sampling #1: not a normal distribution
aov <- aov(bc_NH4 ~ treatment, data = subset(soil_fert_24, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "5"))
kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_24, month == "5"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "FC"))
```

```{r}
#Sampling #2: normal distribution. BM is significantly different from mulches according to ANOVA and KW. If we consider crops individually, there is a difference between BM and CM for FC.
aov <- aov(bc_NH4 ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20"))
dunnTest(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20"))


kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-06-20"))

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20" & crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20" & crop == "FC"))
dunnTest(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-06-20" & crop == "FC"))


#LMM: block is not a significant RE
model <- lmer(NH4_ppm ~ treatment + (1 | block), data = subset(soil_fert_24, sample_date == "2024-06-20"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```


```{r}
#Sampling #3: mostly normal distribution. no significant differences
aov <- aov(bc_NH4 ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10"))
kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_24, sample_date == "2024-07-10"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10" & crop == "DB"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, sample_date == "2024-07-10" & crop == "FC"))

#LMM: block is not a significant RE
model <- lmer(NH4_ppm ~ treatment + (1 | block), data = subset(soil_fert_24, sample_date == "2024-07-10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

```{r}

#Sampling # 4: mostly normal distribution. no significant differences
aov <- aov(bc_NH4 ~ treatment, data = subset(soil_fert_24, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "10"))
dunnTest(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "10"))

kruskal.test(NH4_ppm ~ crop, data = subset(soil_fert_24, month == "10"))
dunnTest(NH4_ppm ~ crop, data = subset(soil_fert_24, month == "10"))

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "AS"))
kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))
dunnTest(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))

kruskal.test(NH4_ppm ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "FC"))

#LMM: isSingular
model <- lmer(bc_NH4 ~ treatment + (1 | block), data = subset(soil_fert_24, month == "10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

### Total Nitrogen

#### Visualization

These are the most relevant visualizations

```{r}
# N by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_n_wt_pct, fill = treatment)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_n_wt_pct, color = treatment)) + geom_point() + geom_smooth(method = lm)

# N by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_n_wt_pct)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_n_wt_pct)) + geom_point() + geom_smooth(method = lm)

```

```{r}

# N by sample date for each crop-treatment combination
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_n_wt_pct, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(soil_fert, aes(x = sample_date, y = total_n_wt_pct, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)

# N by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_n_wt_pct, fill = treatment)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_n_wt_pct, color = treatment)) + geom_point() + geom_smooth(method = lm)

# N by sample date for each crop
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_n_wt_pct, fill = crop)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_n_wt_pct, color = crop)) + geom_point() + geom_smooth(method = lm)

# N by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = total_n_wt_pct)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = total_n_wt_pct)) + geom_point() + geom_smooth(method = lm)

# N overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = total_n_wt_pct, fill = treatment)) + geom_boxplot()

# N overall for treatment
ggplot(soil_fert, aes(x = treatment, y = total_n_wt_pct)) + geom_boxplot()

# N overall for crop
ggplot(soil_fert, aes(x = crop, y = total_n_wt_pct)) + geom_boxplot()

# N for 2023 by crop-treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = total_n_wt_pct, fill = treatment)) + geom_boxplot()

# N for 2023 by treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = treatment, y = total_n_wt_pct)) + geom_boxplot()

# N for 2023 by crop
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = total_n_wt_pct)) + geom_boxplot()


# N for 2024 by crop-treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = total_n_wt_pct, fill = treatment)) + geom_boxplot()

# N for 2024 by treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = treatment, y = total_n_wt_pct)) + geom_boxplot()

# N for 2024 by crop
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = total_n_wt_pct)) + geom_boxplot()



```



#### Overall

```{r}
# ANOVA: there is a significant difference between years, but not crops or treatments
aov <- aov(total_n_wt_pct ~ treatment*crop*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_n_wt_pct ~ treatment*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_n_wt_pct ~ year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is a significant different between study years, but not between treatments and crops. 

kruskal.test(total_n_wt_pct ~ treatment, data = soil_fert)
kruskal.test(total_n_wt_pct ~ crop, data = soil_fert)

kruskal.test(total_n_wt_pct ~ year, data = soil_fert)
kruskal.test(total_n_wt_pct ~ year, data = subset(soil_fert, treatment == "BM"))
kruskal.test(total_n_wt_pct ~ year, data = subset(soil_fert, treatment == "SM"))
kruskal.test(total_n_wt_pct ~ year, data = subset(soil_fert, treatment == "CM"))

# LMM for the best ANOVA: block is a significant random effect
model <- lmer(total_n_wt_pct ~ year + (1 | block), data = soil_fert)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ year)


```
Comparing start to end

```{r}
#ANOVA shows a significant difference between the start and end of the experiment, but that's across the board, not for a specific treatment/crop. The data doesn't appear to as normally distributed (LMM is...okay for this)

aov <- aov(total_n_wt_pct ~ treatment*year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_n_wt_pct ~ year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_n_wt_pct ~ year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
kruskal.test(total_n_wt_pct ~ year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024") & treatment == "BM"))
kruskal.test(total_n_wt_pct ~ year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024") & treatment == "CM"))
kruskal.test(total_n_wt_pct ~ year, data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024") & treatment == "SM"))

#LMM for the top model. block is a significant random effect
model <- lmer(total_n_wt_pct ~ year + (1 | block), data = subset(soil_fert, (month == "5" & year == "2023") | (month == "10" & year == "2024")))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ year)


```

#### 2023

Overall, there is not a significant difference between treatments or crops

```{r}
# ANOVA
aov <- aov(total_n_wt_pct ~ treatment, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is not a significant difference between treatments or crops in 2023, nor is there a difference between crops within treatments
kruskal.test(total_n_wt_pct ~ treatment, data = soil_fert_23)
kruskal.test(total_n_wt_pct ~ crop, data = soil_fert_23)
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23,crop == "AS"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, crop == "DB"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, crop == "FC"))

#LMM: block is a significant random effect 
model <- lmer(total_n_wt_pct ~ treatment + (1 | block), data = soil_fert_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```


Comparing spring to fall, there is a significant difference -- but no interactions with treatment. When I limit to individual treatments (as KW, because the datasets get non-parametric), then there is a significant difference between each treatment from one month to the next

```{r}
# there is a significant difference between spring and fall, there is not difference for treatments
aov <- aov(total_n_wt_pct ~ treatment*month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_n_wt_pct ~ month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_n_wt_pct ~ month, data = soil_fert_23)
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert_23, treatment == "BM"))
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert_23, treatment == "SM"))
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert_23, treatment == "CM"))

#LMM: block is significant RE
model <- lmer(total_n_wt_pct ~ month + (1 | block), data = soil_fert_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ month)
```

Comparing fall 2023 to spring 2024, there is not a significant difference

```{r}
# doesn't seem to be a difference between fall and spring, but it's non-parametric 
aov <- aov(total_n_wt_pct ~ treatment*month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is not a difference between spring and fall
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01"))
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01" & treatment == "BM"))
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01" & treatment == "SM"))
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01" & treatment == "CM"))
```

Individual sampling events: ANOVA shows no difference between crops or treatments for each sampling event, and they seem non-parametric. Affirmed by KW tests.

```{r}
#Sampling #1
aov <- aov(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5"))
kruskal.test(total_n_wt_pct ~ crop, data = subset(soil_fert_23, month == "5"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "AS"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "DB"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(total_n_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_23, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

```{r}

#Sampling # 2
aov <- aov(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10"))
kruskal.test(total_n_wt_pct ~ crop, data = subset(soil_fert_23, month == "10"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "AS"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "DB"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(total_n_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_23, month == "10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

#### 2024

For the whole year: There is no significant differences in CN ratio between treatments and crops (or their interactions). Affirmed by KW

```{r}

# ANOVA
aov <- aov(total_n_wt_pct ~ treatment, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is not a significant difference between treatments or crops in 2023, nor is there a difference between crops within treatments
kruskal.test(total_n_wt_pct ~ treatment, data = soil_fert_24)
kruskal.test(total_n_wt_pct ~ crop, data = soil_fert_24)
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24,crop == "AS"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, crop == "DB"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, crop == "FC"))

#LMM: block is a significant random effect 
model <- lmer(total_n_wt_pct ~ treatment + (1 | block), data = soil_fert_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

Comparing spring to fall, there is not a significant difference.

```{r}
#ANOVA
aov <- aov(total_n_wt_pct ~ treatment*month, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(total_n_wt_pct ~ month, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_n_wt_pct ~ month, data = soil_fert_24)
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert_24, treatment == "BM"))
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert_24, treatment == "SM"))
kruskal.test(total_n_wt_pct ~ month, data = subset(soil_fert_24, treatment == "CM"))

#LMM: block is significant RE
model <- lmer(total_n_wt_pct ~ month + (1 | block), data = soil_fert_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ month)

```

ANOVAs indicates that there's no difference between crop or treatments in May or October, but they're non-parametric. KW's affirm there is no difference

```{r}
#Sampling #1
aov <- aov(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5"))
kruskal.test(total_n_wt_pct ~ crop, data = subset(soil_fert_24, month == "5"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "AS"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "DB"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "FC"))

#LMM: block is a significant RE
model <- lmer(total_n_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_24, month == "5"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

```{r}

#Sampling # 2
aov <- aov(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10"))
kruskal.test(total_n_wt_pct ~ crop, data = subset(soil_fert_24, month == "10"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "AS"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))
kruskal.test(total_n_wt_pct ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "FC"))

#LMM: block is a not a significant RE
model <- lmer(total_n_wt_pct ~ treatment + (1 | block), data = subset(soil_fert_24, month == "10"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

### ACE

#### Visualization

```{r}


```

#### Normality

```{r}

```

#### ANOVA

```{r}

```

#### Linear Mixed Model

```{r}

```

## C:N Ratio

### Visualization

These are the visualizations that are most representative of the results:

```{r}

# C:N by sample date for each treatment
ggplot(soil_fert, aes(x = as.factor(sample_date), y = cn_ratio, fill = treatment)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = cn_ratio, color = treatment)) + geom_point() + geom_smooth(method = lm)

# C:N by sample date
ggplot(soil_fert, aes(x = as.factor(sample_date), y = cn_ratio)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = cn_ratio)) + geom_point() + geom_smooth(method = lm)


```

```{r}
# C:N by sample date for each crop-treatment combination
ggplot(soil_fert, aes(x = as.factor(sample_date), y = cn_ratio, fill = treatment)) + geom_boxplot() + facet_wrap(~crop) 

ggplot(soil_fert, aes(x = sample_date, y = cn_ratio, color = treatment)) + geom_point() + facet_wrap(~crop) + geom_smooth(method = lm)

# C:N by sample date for each crop
ggplot(soil_fert, aes(x = as.factor(sample_date), y = cn_ratio, fill = crop)) + geom_boxplot() 

ggplot(soil_fert, aes(x = sample_date, y = cn_ratio, color = crop)) + geom_point() + geom_smooth(method = lm)

# C:N overall for crop-treatment
ggplot(soil_fert, aes(x = crop, y = cn_ratio, fill = treatment)) + geom_boxplot()

# C:N overall for treatment
ggplot(soil_fert, aes(x = treatment, y = cn_ratio)) + geom_boxplot()

# C:N overall for crop
ggplot(soil_fert, aes(x = crop, y = cn_ratio)) + geom_boxplot()

# C:N for 2023 by crop-treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = cn_ratio, fill = treatment)) + geom_boxplot()

# C:N for 2023 by treatment
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = treatment, y = cn_ratio)) + geom_boxplot()

# C:N for 2023 by crop
ggplot(subset(soil_fert, sample_date < "2023-12-31"), aes(x = crop, y = cn_ratio)) + geom_boxplot()


# C:N for 2024 by crop-treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = cn_ratio, fill = treatment)) + geom_boxplot()

# C:N for 2024 by treatment
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = treatment, y = cn_ratio)) + geom_boxplot()

# C:N for 2024 by crop
ggplot(subset(soil_fert, sample_date > "2023-12-31"), aes(x = crop, y = cn_ratio)) + geom_boxplot()

```


### Overall

```{r}
# Violates model assumptions
aov <- aov(cn_ratio ~ treatment*crop*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# Violates model assumptions
aov <- aov(cn_ratio ~ treatment*year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# this is the only one that might be okay, but the KW test is way more reliable
aov <- aov(cn_ratio ~ year, data = soil_fert)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is a significant different between study years, but not between treatments and crops. 

kruskal.test(cn_ratio ~ treatment, data = soil_fert)
kruskal.test(cn_ratio ~ crop, data = soil_fert)

kruskal.test(cn_ratio ~ year, data = soil_fert)
kruskal.test(cn_ratio ~ year, data = subset(soil_fert, treatment == "BM"))
kruskal.test(cn_ratio ~ year, data = subset(soil_fert, treatment == "SM"))
kruskal.test(cn_ratio ~ year, data = subset(soil_fert, treatment == "CM"))

```
```{r}
#difference between years but not treatments, comparing start and end of study
aov <- aov(cn_ratio ~ treatment*year, data = subset(soil_fert, sample_date == "2023-05-23" | sample_date == "2024-10-17"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(cn_ratio ~ year, data = subset(soil_fert, sample_date == "2023-05-23" | sample_date == "2024-10-17"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# year is different for each treatment
kruskal.test(cn_ratio ~ year, data = subset(soil_fert, sample_date == "2023-05-23" | sample_date == "2024-10-17"))
kruskal.test(cn_ratio ~ year, data = subset(soil_fert, (sample_date == "2023-05-23" | sample_date == "2024-10-17") & treatment == "BM"))
kruskal.test(cn_ratio ~ year, data = subset(soil_fert, (sample_date == "2023-05-23" | sample_date == "2024-10-17") & treatment == "SM"))
kruskal.test(cn_ratio ~ year, data = subset(soil_fert, (sample_date == "2023-05-23" | sample_date == "2024-10-17") & treatment == "CM"))

#LMM models are all isSingular
```


#### 2023

```{r}
# data is close to a normal distribution according to residual plots when we just look at 2023. There is no significant difference between treatments
aov <- aov(cn_ratio ~ treatment, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


#there is not a significant difference between treatments or crops in 2023, nor is there a difference between crops within treatments
kruskal.test(cn_ratio ~ treatment, data = soil_fert_23)
kruskal.test(cn_ratio ~ crop, data = soil_fert_23)
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, crop == "AS"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, crop == "DB"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, crop == "FC"))

#LMM for the top model: block is not a significant RE
model <- lmer(cn_ratio ~ treatment + (1 | block), data = soil_fert_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

Comparing spring to fall, there is a significant difference -- but no interactions with treatment. When I limit to individual treatments (as KW, because the datasets get non-parametric), then there is a significant difference between each treatment from one month to the next

```{r}
# there is a significant difference between spring and fall, there is not difference for treatments and crops
aov <- aov(cn_ratio ~ treatment*month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(cn_ratio ~ month, data = soil_fert_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(cn_ratio ~ month, data = soil_fert_23)
kruskal.test(cn_ratio ~ month, data = subset(soil_fert_23, treatment == "BM"))
kruskal.test(cn_ratio ~ month, data = subset(soil_fert_23, treatment == "SM"))
kruskal.test(cn_ratio ~ month, data = subset(soil_fert_23, treatment == "CM"))

#LMM are all isSingular
```

Comparing fall 2023 to spring 2024,

```{r}
# there might be a significant difference between fall and spring, but it's non-parametric so
aov <- aov(cn_ratio ~ treatment*month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#there is a difference between spring and fall -- and we can attribute it to bare soil
kruskal.test(cn_ratio ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01"))
kruskal.test(cn_ratio ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01" & treatment == "BM"))
kruskal.test(cn_ratio ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01" & treatment == "SM"))
kruskal.test(cn_ratio ~ month, data = subset(soil_fert, sample_date > "2023-10-01" & sample_date < "2024-06-01" & treatment == "CM"))
```

Individual sampling events: ANOVA shows no difference between crops or treatments for each sampling event, but they are non-parametric. Affirmed by KW tests.

```{r}
#Sampling #1
aov <- aov(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "5"))
kruskal.test(cn_ratio ~ crop, data = subset(soil_fert_23, month == "5"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "AS"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "DB"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "5" & crop == "FC"))

#Sampling # 2
aov <- aov(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "10"))
kruskal.test(cn_ratio ~ crop, data = subset(soil_fert_23, month == "10"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "AS"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "DB"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_23, month == "10" & crop == "FC"))

```

#### 2024

For the whole year: There is no significant differences in CN ratio between treatments and crops (or their interactions). Affirmed by KW

```{r}
# violates model assumptions
aov <- aov(cn_ratio ~ treatment, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


#there is not a significant difference between treatments or crops in 2023, nor is there a difference between crops within treatments
kruskal.test(cn_ratio ~ treatment, data = soil_fert_24)
kruskal.test(cn_ratio ~ crop, data = soil_fert_24)
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, crop == "AS"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, crop == "DB"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, crop == "FC"))

```

```{r}
# there is a significant difference between spring and fall, there is not difference for treatments and crops
aov <- aov(cn_ratio ~ treatment*month, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

aov <- aov(cn_ratio ~ month, data = soil_fert_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(cn_ratio ~ month, data = soil_fert_24)
kruskal.test(cn_ratio ~ month, data = subset(soil_fert_24, treatment == "BM"))
kruskal.test(cn_ratio ~ month, data = subset(soil_fert_24, treatment == "SM"))
kruskal.test(cn_ratio ~ month, data = subset(soil_fert_24, treatment == "CM"))

#LMM are all isSingular
```

ANOVAs indicates that there's no difference between crop or treatments in May or October, and they're mostly normally distributed.

```{r}
#Sampling #1
aov <- aov(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "5"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "5"))
kruskal.test(cn_ratio ~ crop, data = subset(soil_fert_24, month == "5"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "AS"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "DB"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "5" & crop == "FC"))

#Sampling # 2
aov <- aov(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "10"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# there is a significant difference between AS and DB -- 
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "10"))
kruskal.test(cn_ratio ~ crop, data = subset(soil_fert_24, month == "10"))
dunnTest(cn_ratio ~ crop, data = subset(soil_fert_24, month == "10"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "AS"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "DB"))
kruskal.test(cn_ratio ~ treatment, data = subset(soil_fert_24, month == "10" & crop == "FC"))

# but only if treatment isn't considered, and I don't think I'm interested in that analysis
kruskal.test(cn_ratio ~ crop, data = subset(soil_fert_24, month == "10" & treatment == "BM"))
kruskal.test(cn_ratio ~ crop, data = subset(soil_fert_24, month == "10" & treatment == "CM"))
kruskal.test(cn_ratio ~ crop, data = subset(soil_fert_24, month == "10" & treatment == "SM"))

```
