---
title: "Weed Biomass and Labor"
---

## Packages

```{r}
library(tidyr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(here)
library(MASS) #boxcox transformation
library(lme4)         #mixed models
library(lmerTest)     #mixed models
library(broom.mixed)  #mixed models
library(emmeans)
library(moments) #skewness function
library(FSA)          # dunnTest function

```

## Loading Data

```{r}
weed_biomass <- read.csv(here::here("00-data", "b-prepared", 
                                 "20250714_SCM-weed biomass.csv"), 
                      header = TRUE)

weed_labor <- read.csv(here::here("00-data", "b-prepared", 
                                  "20250714_SCM-weed labor.csv"), 
                     header = TRUE)

```

## Format Data

```{r}
weed_biomass <- weed_biomass %>%
                subset(block != 5) %>%
                mutate(date_collected = lubridate::as_date(date_collected, format = "%m/%d/%Y"),
                       year = lubridate::isoyear(ymd(date_collected)),
                       od_g = ifelse(od_biomass_calculated_g < 0, 0, od_biomass_calculated_g),
                       biomass_g_m2 = ((od_g / 0.1) * (60 * 0.3048^2))) %>%
                mutate_at(c('weeding_point', 'block', 'plot', 'treatment', 'crop'), as.factor)

weed_labor <- weed_labor %>%
              subset(block != 5) %>% 
              mutate(date_collected = lubridate::as_date(date_collected, format = "%m/%d/%Y"),
                     year = lubridate::isoyear(ymd(date_collected)),
                     time_m2 = time_min/((60 * 0.3048^2) - 0.1)) %>%
              mutate_at(c('weeding_point', 'block', 'plot', 'treatment', 'crop', "collected_by", "year"), as.factor) %>%
              dplyr::select(-c(start.time, end.time, total.time))
```

## Weed Biomass

#### For manuscript

##### Statistical Analysis

```{r}
# Across both study years, all treatments are significantly difference
kruskal.test(od_g ~ treatment, weed_biomass)
dunnTest(od_g ~ treatment, weed_biomass)

# But the winner is that there is a significant difference between years
kruskal.test(od_g ~ year, weed_biomass) 

#still go to individual sections for remaining KW tests

```

##### Figures and Tables

```{r}
# average and SD
sum_stat_weed_biomass <- weed_biomass %>%
                         group_by(year, treatment) %>%
                         summarize(min = min(biomass_g_m2, na.rm = TRUE),
                                   median = median(biomass_g_m2, na.rm = TRUE),
                                   max = max(biomass_g_m2, na.rm = TRUE),
                                   mean = mean(biomass_g_m2, na.rm = TRUE),
                                   sd = sd(biomass_g_m2, na.rm = TRUE))

#write.csv(sum_stat_weed_biomass, here::here("20250811_SCM_weed biomass.csv"), row.names=TRUE)

# SI figure:

ggplot(data = subset(weed_biomass, year == "2023"), 
       aes(x = weeding_point, 
           y = biomass_g_m2, 
           fill = treatment)) + 
  geom_boxplot() + 
  theme_bw() + 
  xlab("Weeks After Mulching") +
  ylab(bquote("Oven dried biomass  " (g/m^2))) +
  theme(axis.title.y = element_text(vjust = 3),
        legend.position = "inside",
        legend.position.inside = c(0.8,0.75)) +
  scale_fill_manual(name = "Mulch Treatment", 
                    labels = c("Bare soil", "Shredded Cardboard", "Straw"), 
                    values = c("#A6CEE3", "#6A3D9A", "#CAB2D6")) +
  scale_x_discrete(labels = c("2", "4", "6", "9")) +
  annotate("text", x = 0.75, y = 750, label = "a") +
  annotate("text", x = 1, y = 750, label = "b") +
  annotate("text", x = 1.25, y = 750, label = "ab") +
  annotate("text", x = 1.75, y = 550, label = "a") +
  annotate("text", x = 2, y = 550, label = "b") +
  annotate("text", x = 2.25, y = 550, label = "ac") +
  annotate("text", x = 2.75, y = 275, label = "a") +
  annotate("text", x = 3, y = 275, label = "a") +
  annotate("text", x = 3.25, y = 275, label = "a") +
  annotate("text", x = 3.75, y = 275, label = "a") +
  annotate("text", x = 4, y = 275, label = "a") +
  annotate("text", x = 4.25, y = 275, label = "a")

ggsave("20250812_SCM_biomass_2023.png", width = 6, height = 4)


ggplot(data = subset(weed_biomass, year == "2024"), 
       aes(x = weeding_point, 
           y = biomass_g_m2, 
           fill = treatment)) + 
  geom_boxplot() + 
  theme_bw() + 
  xlab("Weeks After Mulching") +
  ylab(bquote("Oven dried biomass  " (g/m^2))) +
  theme(axis.title.y = element_text(vjust = 3)) +
  scale_fill_manual(name = "Mulch Treatment", 
                    labels = c("Bare soil", "Shredded Cardboard", "Straw"), 
                    values = c("#A6CEE3", "#6A3D9A", "#CAB2D6")) +
  scale_x_discrete(labels = c("2", "5", "7", "11")) +
  guides(fill = FALSE) +
  annotate("text", x = 0.75, y = 1250, label = "a") +
  annotate("text", x = 1, y = 1250, label = "b") +
  annotate("text", x = 1.25, y = 1250, label = "b") +
  annotate("text", x = 1.75, y = 2350, label = "a") +
  annotate("text", x = 2, y = 2350, label = "b") +
  annotate("text", x = 2.25, y = 2350, label = "b") +
  annotate("text", x = 2.75, y = 700, label = "a") +
  annotate("text", x = 3, y = 700, label = "b") +
  annotate("text", x = 3.25, y = 700, label = "ab") +
  annotate("text", x = 3.75, y = 700, label = "a") +
  annotate("text", x = 4, y = 700, label = "b") +
  annotate("text", x = 4.25, y = 700, label = "a")

ggsave("20250812_SCM_biomass_2024.png", width = 6, height = 4)

```

### Visualization

Most representative of statistical analysis

```{r}
#crops combined, year visualized by weed collection/treatment
ggplot(subset(weed_biomass, year == "2023"), aes(x = weeding_point, y = biomass_kg_m2, fill = treatment)) + geom_boxplot() 

ggplot(subset(weed_biomass, year == "2024"), aes(x = weeding_point, y = biomass_kg_m2, fill = treatment)) + geom_boxplot() 

#crops and weeding point combined, visualized by treatment for each year
ggplot(weed_biomass, aes(x = as.factor(year), y = biomass_kg_m2, fill = treatment)) + geom_boxplot()

```

Additional visualizations

```{r}
#visualized each year separately, by weed collection for each crop/treatment
ggplot(subset(weed_biomass, year == 2023), aes(x = weeding_point, y = od_g, fill = treatment)) + geom_boxplot() + facet_wrap(~crop)
ggplot(subset(weed_biomass, year == 2024), aes(x = weeding_point, y = od_g, fill = treatment)) + geom_boxplot() + facet_wrap(~crop)

#years combined, visualized by weed collection for each crop/treatment
ggplot(weed_biomass, aes(x = weeding_point, y = od_g, fill = treatment)) + geom_boxplot() + facet_wrap(~crop)

#weeding point combined, visualized by crop/treatment for each year
ggplot(weed_biomass, aes(x = crop, y = od_g, fill = treatment)) + geom_boxplot() + facet_wrap(~year)

#weeding point and year combined, visualized by crop/treatment
ggplot(weed_biomass, aes(x = crop, y = od_g, fill = treatment)) + geom_boxplot()

# just treatments
ggplot(weed_biomass, aes(x = treatment, y = od_g)) + geom_boxplot()

```

#### Normality and outliers


##### Overall

Over half of the outliers are bare soil. Furthermore, none of them feel outside the realm of what we observed re: weed growth
```{r}
Q1 <- quantile(weed_biomass$od_g, 0.25, na.rm = TRUE) 
Q3 <- quantile(weed_biomass$od_g, 0.75, na.rm = TRUE) 
IQR <- IQR(weed_biomass$od_g,na.rm = TRUE)

lower_bound <- Q1 - (1.5*IQR)
upper_bound <- Q3 + (1.5*IQR)

subset(weed_biomass, weed_biomass$od_g > upper_bound | 
                    weed_biomass$od_g < lower_bound)
```


```{r}
hist(weed_biomass$od_g)
skewness(weed_biomass$od_g, na.rm = TRUE)
qqnorm(weed_biomass$od_g, main='Normal')
qqline(weed_biomass$od_g)
shapiro.test(weed_biomass$od_g)

#lambda is close to -1, indicating that a boxcox or inverse transformation would be best. neither is successful

#boxcox
bc <- boxcox(lm((weed_biomass$od_g + 1) ~ 1))
lambda <- bc$x[which.max(bc$y)]
weed_biomass$bc_od <- ((weed_biomass$od_g + 1) ^ lambda -1)/lambda

hist(weed_biomass$bc_od)
skewness(weed_biomass$bc_od, na.rm = TRUE)
qqnorm(weed_biomass$bc_od, main='Normal')
qqline(weed_biomass$bc_od)
shapiro.test(weed_biomass$bc_od)

#inverse
weed_biomass$inverse_od <- 1/(weed_biomass$od_g+1)

hist(weed_biomass$inverse_od)
skewness(weed_biomass$inverse_od, na.rm = TRUE)
qqnorm(weed_biomass$inverse_od, main='Normal')
qqline(weed_biomass$inverse_od)
shapiro.test(weed_biomass$inverse_od)

```

##### 2023

The original data is non-parametric. lambda is close to -2, indicating that a boxcox or inverse squared transformation would be best. neither is successful.
```{r}
weed_biomass_23 <- subset(weed_biomass, year == "2023")

#outlier check - same conclusions as overall
Q1 <- quantile(weed_biomass_23$od_g, 0.25, na.rm = TRUE) 
Q3 <- quantile(weed_biomass_23$od_g, 0.75, na.rm = TRUE) 
IQR <- IQR(weed_biomass_23$od_g,na.rm = TRUE)

lower_bound <- Q1 - (1.5*IQR)
upper_bound <- Q3 + (1.5*IQR)

subset(weed_biomass_23, weed_biomass_23$od_g > upper_bound | 
                    weed_biomass_23$od_g < lower_bound)

#original dataset
hist(weed_biomass_23$od_g)
skewness(weed_biomass_23$od_g, na.rm = TRUE)
qqnorm(weed_biomass_23$od_g, main='Normal')
qqline(weed_biomass_23$od_g)
shapiro.test(weed_biomass_23$od_g)

#boxcox
bc <- boxcox(lm((weed_biomass_23$od_g + 1) ~ 1))
lambda <- bc$x[which.max(bc$y)]
weed_biomass_23$bc_od <- ((weed_biomass_23$od_g + 1) ^ lambda -1)/lambda

hist(weed_biomass_23$bc_od)
skewness(weed_biomass_23$bc_od, na.rm = TRUE)
qqnorm(weed_biomass_23$bc_od, main='Normal')
qqline(weed_biomass_23$bc_od)
shapiro.test(weed_biomass_23$bc_od)

#inverse sq
weed_biomass_23$inverse_sq_od <- 1/(weed_biomass_23$od_g+1)^2

hist(weed_biomass_23$inverse_sq_od)
skewness(weed_biomass_23$inverse_sq_od, na.rm = TRUE)
qqnorm(weed_biomass_23$inverse_sq_od, main='Normal')
qqline(weed_biomass_23$inverse_sq_od)
shapiro.test(weed_biomass_23$inverse_sq_od)

```

##### 2024
The original dataset is non-parametric. Lambda is between -0.5 and -1, indicating that a boxcox, inverse, or inverse sqrt would be most appropriate. none are successful.
```{r}
weed_biomass_24 <- subset(weed_biomass, year == "2024")

#outlier check - same conclusions as overall
Q1 <- quantile(weed_biomass_24$od_g, 0.25, na.rm = TRUE) 
Q3 <- quantile(weed_biomass_24$od_g, 0.75, na.rm = TRUE) 
IQR <- IQR(weed_biomass_24$od_g,na.rm = TRUE)

lower_bound <- Q1 - (1.5*IQR)
upper_bound <- Q3 + (1.5*IQR)

subset(weed_biomass_24, weed_biomass_24$od_g > upper_bound | 
                    weed_biomass_24$od_g < lower_bound)

#original dataset
hist(weed_biomass_24$od_g)
skewness(weed_biomass_24$od_g, na.rm = TRUE)
qqnorm(weed_biomass_24$od_g, main='Normal')
qqline(weed_biomass_24$od_g)
shapiro.test(weed_biomass_24$od_g)

#boxcox
bc <- boxcox(lm((weed_biomass_24$od_g + 1) ~ 1))
lambda <- bc$x[which.max(bc$y)]
weed_biomass_24$bc_od <- ((weed_biomass_24$od_g + 1) ^ lambda -1)/lambda

hist(weed_biomass_24$bc_od)
skewness(weed_biomass_24$bc_od, na.rm = TRUE)
qqnorm(weed_biomass_24$bc_od, main='Normal')
qqline(weed_biomass_24$bc_od)
shapiro.test(weed_biomass_24$bc_od)

#inverse
weed_biomass_24$inverse_od <- 1/(weed_biomass_24$od_g+1)

hist(weed_biomass_24$inverse_od)
skewness(weed_biomass_24$inverse_od, na.rm = TRUE)
qqnorm(weed_biomass_24$inverse_od, main='Normal')
qqline(weed_biomass_24$inverse_od)
shapiro.test(weed_biomass_24$inverse_od)

#inverse sqrt
weed_biomass_24$sqrt_od <- 1/sqrt(weed_biomass_24$od_g+1)

hist(weed_biomass_24$sqrt_od)
skewness(weed_biomass_24$sqrt_od, na.rm = TRUE)
qqnorm(weed_biomass_24$sqrt_od, main='Normal')
qqline(weed_biomass_24$sqrt_od)
shapiro.test(weed_biomass_24$sqrt_od)

```

### Overall
```{r}
# double checked - ANOVA doesn't work because dataset is non-parametric

# Across both study years, all treatments are significantly difference
kruskal.test(od_g ~ treatment, weed_biomass)
dunnTest(od_g ~ treatment, weed_biomass)

# There is a nearly significant difference between strawberries and collards, which appears to be largely driven by bare soil
kruskal.test(od_g ~ crop, weed_biomass)
dunnTest(od_g ~ crop, weed_biomass)

# nearly significant difference between AS-FC
kruskal.test(od_g ~ crop, subset(weed_biomass, treatment == "BM"))
dunnTest(od_g ~ crop, subset(weed_biomass, treatment == "BM"))

# no difference
kruskal.test(od_g ~ crop, subset(weed_biomass, treatment == "CM"))
dunnTest(od_g ~ crop, subset(weed_biomass, treatment == "CM"))

# no difference
kruskal.test(od_g ~ crop, subset(weed_biomass, treatment == "SM"))
dunnTest(od_g ~ crop, subset(weed_biomass, treatment == "SM"))

# But the winner is that there is a significant difference between years
kruskal.test(od_g ~ year, weed_biomass) # p < 0.001, so analyzing years separately

```

#### 2023

```{r}

#ANOVAs are non-parametric
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2023"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# significant difference between CM and BM/SM
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023"))

#check to see if there is a significant difference between crops within a treatment. 
#Nearly significant difference between AS-FC
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "BM"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "BM"))

# no difference
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "CM"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "CM"))

# nearly significant difference between AS-DB
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "SM"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "SM"))

kruskal.test(od_g ~ weeding_point, subset(weed_biomass, year == "2023")) # p < 0.001, so analyzing each weeding point separately

```

##### Weeding Day 1

When crops are combined, there were significantly more weeds in bare soil compared to cardboard mulch (p \< 0.002). Weed biomass under straw mulch was not significantly different from bare soil or cardboard.

```{r}
#ANOVA is non-parametric. better than overall though
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "1"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & weeding_point == "1")) # p > 0.05, so combining crops to look at treatments

kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "1"))

dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "1")) 

```

##### Weeding Day 2

When crops are combined, there were significantly less weed biomass under cardboard mulch compared to bare soil (p = 0.007) and straw mulch (p = 0.02).

```{r}
#ANOVA is non-parametric. 
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "2"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & weeding_point == "2")) # p > 0.05, so combining crops to look at treatments

kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "2"))

dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "2")) 

```

##### Weeding Day 3

When we reached the third weeding day, there was a significant difference in weed biomass between crops was observed (p = 0.01). For strawberries, weed biomass under cardboard mulch was significantly less than bare soil (p = 0.03). All other crop-treatment combinations were not significantly different from each other.

```{r}
#ANOVA is non-parametric. 
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & weeding_point == "3")) # p = 0.01, so crops are analyzed individually (plus I also combine for consistency with previous days)

kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "2"))

dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "2")) 

#significant difference between AS-FC
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "BM" & weeding_point == "3"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "BM" & weeding_point == "3"))

# no difference
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "CM" & weeding_point == "3"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "CM" & weeding_point == "3"))

# nearly significant difference between AS-DB
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "SM" & weeding_point == "3"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2023" & treatment == "SM" & weeding_point == "3"))
```


```{r}

#Strawberries: BM-CM significantly different
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3" & crop == "AS"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3" & crop == "AS")) 

#Dragon tongue beans: no significant difference 
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3" & crop == "DB"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3" & crop == "DB")) 

#Collards: no significant difference
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3" & crop == "FC"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3" & crop == "FC")) 

#crops combined: no significant difference
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "3")) 

```

##### Weeding Day 4

Mulch treatment did not impact weed biomass during our fourth collection point (p = 0.4).

```{r}
#ANOVA is non-parametric. 
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "4"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2023" & weeding_point == "4")) # p = 0.4, so crops were combined

kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2023" & weeding_point == "4"))

```

#### 2024

```{r}

#ANOVAs are non-parametric
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2024"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# significant difference between all treatments
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2024"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2024"))

#check to see if there is a significant difference between crops within a treatment. 
# no difference
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2024" & treatment == "BM"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2024" & treatment == "BM"))

# no difference
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2024" & treatment == "CM"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2024" & treatment == "CM"))

# no difference
kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2024" & treatment == "SM"))
dunnTest(od_g ~ crop, subset(weed_biomass, year == "2024" & treatment == "SM"))

kruskal.test(od_g ~ weeding_point, subset(weed_biomass, year == "2024")) # p < 0.001, so analyzing each weeding point separately

```

##### Weeding Day 1

When crops were combined, weed biomass was significantly higher in bare soil compared to both mulch treatments (p \< 0.001). There was not, however, a difference in biomass between cardboard and straw mulch (p = 0.5).

```{r}

#ANOVAs are non-parametric
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "1"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2024" & weeding_point == "1")) # p > 0.05, so combining crops to look at treatments
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "1"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "1")) 

```

##### Weeding Day 2

When crops were combined, weed biomass was significantly higher in bare soil compared to cardboard (p \< 0.001) and straw (p = 0.004) mulch. There was not, however, a difference in biomass between the two mulches (p = 0.6)

```{r}
#ANOVAs are non-parametric
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "2"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2024" & weeding_point == "2")) # p > 0.05, so combining crops to look at treatments
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "2"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "2")) 

```

##### Weeding Day 3

When we reached the third weeding day, however, weed biomass in bare soil was only significantly higher than cardboard mulch (p = 0.009).

```{r}
#ANOVAs are non-parametric
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "3"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2024" & weeding_point == "3")) # p > 0.05, so combining crops to look at treatments
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "3"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "3")) 

```

##### Weeding Day 4

During our final weeding day, weed biomass in bare soil remained significantly higher than for cardboard mulch (p = 0.003). However, now, weed biomass in straw mulch was also significantly higher than for cardboard (p \< 0.001)

```{r}
#ANOVAs is actually fairly normal distribution
aov <- aov(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "4"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

kruskal.test(od_g ~ crop, subset(weed_biomass, year == "2024" & weeding_point == "4")) # p > 0.05, so combining crops to look at treatments
kruskal.test(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "4"))
dunnTest(od_g ~ treatment, subset(weed_biomass, year == "2024" & weeding_point == "4")) 

```



## Weed Labor

### checking for impact of person weeding

I didn't actually do this first, but I found what was likely a mis-recorded time that I want to remove from analysis

```{r}
# weeding time visualized for each person  
ggplot(subset(weed_labor, year == "2023"), aes(x = treatment, y = time_min, color = collected_by)) + geom_boxplot() 
ggplot(subset(weed_labor, year == "2024" & treatment == "CM"), aes(x = weeding_point, y = time_min, color = collected_by)) + geom_boxplot() 

plots_by_person <- weed_labor %>%
                   group_by(treatment, collected_by) %>%
                   summarize(count = n(),
                             avg_time = mean(time_min)) %>%
                   ungroup()
plots_by_person

# I checked for interactions with who did the weeding, and I didn't see any concerning ones. (I went through the TukeyHSD results and checked each comparison where two people had weeded the same mulch treatment. Only one combination was signicant for SM: Trick and Nora, and I know from our notes and my memories that Trick just happened to tackle several plots that were especially weedy)
aov <- aov(bc_time ~ treatment*collected_by, data = subset(weed_labor, year == "2023"))
summary(aov)
TukeyHSD(aov)

# Checking for differences in weeding time for different people in 2024. I went through the TukeyHSD results and checked each comparison where two people had weeded the same mulch treatment. Morgan Smith was significantly different than MH (slightly: 0.07), NP (0.006), PM (0.001), and RD (0.001) for cardboard mulch, and slight different from PM for straw mulch (0.06). When compared to the ggplot, I noted that NP weeded earlier in the season (and thus would likely have had longer weeding times). MH had times that were in a similar range with other people who weeded the same weeks as they did. Comparing with biomass, PM was in charge of a plot with A LOT of weed biomass during the second weed collection. RD, however, weeded 1-E during the second collection point, and there was only 0.99 g of dried biomass but it took them 68 minutes. I'm assuming that this was an error recording time and, consequently, removed.
aov <- aov(bc_time ~ treatment*collected_by, data = subset(weed_labor, year == "2024"))
summary(aov)
TukeyHSD(aov)

#use this if you actually want to see the whole output in the previous tukey hsd
#options(max.print = 2150)

ggplot(subset(weed_labor, year == "2024" & treatment == "CM"), aes(x = weeding_point, y = time_min, color = collected_by)) + geom_boxplot() 


```

```{r}
#creating a copy that includes the suspected bad data (weed_labor_out) so I can check whether it impacts analysis
weed_labor_out <- weed_labor
weed_labor$time_min[weed_labor$weeding_point == "2" & weed_labor$block == "1" & weed_labor$plot == "E" & weed_labor$year == "2024"] <- NA

weed_labor$time_m2[weed_labor$weeding_point == "2" & weed_labor$block == "1" & weed_labor$plot == "E" & weed_labor$year == "2024"] <- NA
```

Nearly all the outliers are from 2024. I double checked the CM one, which was the only surprising one, and it had a high biomass.
```{r}
Q1 <- quantile(weed_labor$time_min, 0.25, na.rm = TRUE) 
Q3 <- quantile(weed_labor$time_min, 0.75, na.rm = TRUE) 
IQR <- IQR(weed_labor$time_min,na.rm = TRUE)

lower_bound <- Q1 - (1.5*IQR)
upper_bound <- Q3 + (1.5*IQR)

test <- subset(weed_labor, weed_labor$time_min > upper_bound | 
                    weed_labor$time_min < lower_bound)

```

#### For manuscript

##### Statistical Analysis

```{r}

# Across both study years, all treatments are significantly difference
kruskal.test(time_min ~ treatment, weed_labor)
dunnTest(time_min ~ treatment, weed_labor)

#LMM: weeding point is a significant RE, and so is block in this context
model <- lmer(bc_time ~ treatment*year + (1 | weeding_point/block), data = weed_labor)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

# 2023 LMM: weeding point is a significant RE 
model <- lmer(bc_time ~ treatment + (1 | weeding_point), data = weed_labor_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

#ANOVA: 2 weeks post mulching - significant difference between SM and BM/CM. A very nearly significant difference between BM/CM as well.
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_23, weeding_point == "1"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#ANOVA: 4 weeks post mulching - significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_23, weeding_point == "2"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#ANOVA: 6 weeks post mulching -significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_23, weeding_point == "3"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: 9 weeks post-mulching. significant difference between SM and BM/CM. 
kruskal.test(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "4"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "4"))


# 2024 LMM: weeding point is a significant RE 
model <- lmer(bc_time ~ treatment + (1 | weeding_point), data = weed_labor_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

#ANOVA: 2 week post mulch. no differences
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_24, weeding_point == "1"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#LMM: 4 week post mulch
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_24, weeding_point == "2"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)


#ANOVA: 7 weeks post mulch no differences. nearly significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_24, weeding_point == "3"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#ANOVA: 10 weeks post mulch significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_24, weeding_point == "4"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)


```

##### Figures and Tables

```{r}
# average and SD
sum_stat_weed_time <- weed_labor %>%
                         group_by(year, treatment) %>%
                         summarize(min = min(time_m2, na.rm = TRUE),
                                   median = median(time_m2, na.rm = TRUE),
                                   max = max(time_m2, na.rm = TRUE),
                                   mean = mean(time_m2, na.rm = TRUE),
                                   sd = sd(time_m2, na.rm = TRUE))

write.csv(sum_stat_weed_time, here::here("20250811_SCM_weed_time.csv"), row.names=TRUE)

# SI figure:

ggplot(data = weed_labor, 
       aes(x = year, 
           y = time_m2, 
           fill = treatment)) + 
  geom_boxplot() + 
  theme_bw() + 
  ylab(bquote("Time  " (min/m^2))) +
  theme(axis.title.y = element_text(vjust = 3),
        axis.title.x = element_blank()) +
  scale_fill_manual(name = "Mulch Treatment", 
                    labels = c("Bare soil", "Shredded Cardboard", "Straw"), 
                    values = c("#A6CEE3", "#6A3D9A", "#CAB2D6")) +
  annotate("text", x = 0.75, y = 10.5, label = "a") + 
  annotate("text", x = 1, y = 10.5, label = "a") +
  annotate("text", x = 1.25, y = 10.5, label = "b") +
  annotate("text", x = 1.75, y = 10.5, label = "c") +
  annotate("text", x = 2, y = 10.5, label = "d") +
  annotate("text", x = 2.25, y = 10.5, label = "c")

ggsave("20250813_SCM_time.png", width = 6, height = 4)


ggplot(data = subset(weed_labor, year == "2023"), 
       aes(x = weeding_point, 
           y = time_m2, 
           fill = treatment)) + 
  geom_boxplot() + 
  theme_bw() + 
  xlab("Weeks After Mulching") +
  ylab(bquote("Weeding time  " (min/m^2))) +
  theme(axis.title.y = element_text(vjust = 3),
        legend.position = "inside",
        legend.position.inside = c(0.8,0.75)) +
  scale_fill_manual(name = "Mulch Treatment", 
                    labels = c("Bare soil", "Shredded Cardboard", "Straw"), 
                    values = c("#A6CEE3", "#6A3D9A", "#CAB2D6")) +
  scale_x_discrete(labels = c("2", "4", "6", "9")) +
  annotate("text", x = 0.75, y = 9.2, label = "a") + 
  annotate("text", x = 1, y = 9.2, label = "a") +
  annotate("text", x = 1.25, y = 9.2, label = "b") +
  annotate("text", x = 1.75, y = 6.2, label = "a") +
  annotate("text", x = 2, y = 6.2, label = "a") +
  annotate("text", x = 2.25, y = 6.2, label = "b") +
  annotate("text", x = 2.75, y = 5.9, label = "a") +
  annotate("text", x = 3, y = 5.9, label = "a") +
  annotate("text", x = 3.25, y = 5.9, label = "b") +
  annotate("text", x = 3.75, y = 3.2, label = "ab") +
  annotate("text", x = 4, y = 3.2, label = "a") +
  annotate("text", x = 4.25, y = 3.2, label = "b")

ggsave("20250813_SCM_time_2023.png", width = 6, height = 4)


ggplot(data = subset(weed_labor, year == "2024"), 
       aes(x = weeding_point, 
           y = time_m2, 
           fill = treatment)) + 
  geom_boxplot() + 
  theme_bw() + 
  xlab("Weeks After Mulching") +
  ylab(bquote("Weeding time  " (min/m^2))) +
  theme(axis.title.y = element_text(vjust = 3)) +
  scale_fill_manual(name = "Mulch Treatment", 
                    labels = c("Bare soil", "Shredded Cardboard", "Straw"), 
                    values = c("#A6CEE3", "#6A3D9A", "#CAB2D6")) +
  scale_x_discrete(labels = c("2", "5", "7", "11")) +
  annotate("text", x = 0.75, y = 7.6, label = "a") + 
  annotate("text", x = 1, y = 7.6, label = "a") +
  annotate("text", x = 1.25, y = 7.6, label = "a") +
  annotate("text", x = 1.75, y = 10.3, label = "a") +
  annotate("text", x = 2, y = 10.3, label = "b") +
  annotate("text", x = 2.25, y = 10.3, label = "a") +
  annotate("text", x = 2.75, y = 9.5, label = "a") +
  annotate("text", x = 3, y = 9.5, label = "a") +
  annotate("text", x = 3.25, y = 9.5, label = "a") +
  annotate("text", x = 3.75, y = 3.2, label = "a") +
  annotate("text", x = 4, y = 3.2, label = "b") +
  annotate("text", x = 4.25, y = 3.2, label = "a") +
  guides(fill = FALSE)

ggsave("20250813_SCM_time_2024.png", width = 6, height = 4)

```

### Visualization

This makes me have suspicions about whether they were using hand tools to weed in 2024.

Visualizations I'm most likely to use:

```{r}
#crops combined, year visualized by weed collection/treatment
ggplot(subset(weed_labor, year == "2023"), aes(x = weeding_point, y = time_min, fill = treatment)) + geom_boxplot()

ggplot(subset(weed_labor, year == "2024"), aes(x = weeding_point, y = time_min, fill = treatment)) + geom_boxplot()

#crops and weeding point combined, visualized by treatment for each year
ggplot(weed_labor, aes(x = as.factor(year), y = time_min, fill = treatment)) + geom_boxplot()

```

```{r}
#visualized each year separately, by weed collection for each crop/treatment
ggplot(subset(weed_labor, year == 2023), aes(x = weeding_point, y = time_min, fill = treatment)) + geom_boxplot() + facet_wrap(~crop)
ggplot(subset(weed_labor, year == 2024), aes(x = weeding_point, y = time_min, fill = treatment)) + geom_boxplot() + facet_wrap(~crop)

#years combined, visualized by weed collection for each crop/treatment
ggplot(weed_labor, aes(x = weeding_point, y = time_min, fill = treatment)) + geom_boxplot() + facet_wrap(~crop)

#weeding point combined, visualized by crop/treatment for each year
ggplot(weed_labor, aes(x = crop, y = time_min, fill = treatment)) + geom_boxplot() + facet_wrap(~year)

#weeding point and year combined, visualized by crop/treatment
ggplot(weed_labor, aes(x = crop, y = time_min, fill = treatment)) + geom_boxplot()

#crops combined, year visualized by weed collection/treatment
ggplot(weed_labor, aes(x = weeding_point, y = time_min, fill = treatment)) + geom_boxplot() + facet_wrap(~year)

# just treatments
ggplot(weed_labor, aes(x = treatment, y = time_min)) + geom_boxplot()


```

### Normality

#### overall
The original dataset is non-parametric. Lambda indicates a boxcox or log transformation would be most appropriate.Neither is actually successful, but boxcox gets very close
```{r}
hist(weed_labor$time_min)
skewness(weed_labor$time_min, na.rm = TRUE)
qqnorm(weed_labor$time_min, main='Normal')
qqline(weed_labor$time_min)
shapiro.test(weed_labor$time_min)

#boxcox
bc <- boxcox(lm(weed_labor$time_min ~ 1))
lambda <- bc$x[which.max(bc$y)]
weed_labor$bc_time <- (weed_labor$time_min ^ lambda -1)/lambda

hist(weed_labor$bc_time)
skewness(weed_labor$bc_time, na.rm = TRUE)
qqnorm(weed_labor$bc_time, main='Normal')
qqline(weed_labor$bc_time)
shapiro.test(weed_labor$bc_time)

#log
weed_labor$log_time <- log10(weed_labor$time_min)
hist(weed_labor$log_time)
skewness(weed_labor$log_time, na.rm = TRUE)
qqnorm(weed_labor$log_time, main='Normal')
qqline(weed_labor$log_time)
shapiro.test(weed_labor$log_time)

```

#### 2023 
The original dataset is non-parametric. Lambda is close to 0, indicating boxcox or log would be most appropriate. Both are successful, but boxcox has a better distribution
```{r}
weed_labor_23 <- subset(weed_labor, year == "2023")

# there are a couple bare soils that took longer than I think they needed to. I suspect that they were weeded by hand, rather than with tools
Q1 <- quantile(weed_labor_23$time_min, 0.25, na.rm = TRUE) 
Q3 <- quantile(weed_labor_23$time_min, 0.75, na.rm = TRUE) 
IQR <- IQR(weed_labor_23$time_min,na.rm = TRUE)

lower_bound <- Q1 - (1.5*IQR)
upper_bound <- Q3 + (1.5*IQR)

test <- subset(weed_labor_23, weed_labor_23$time_min > upper_bound | 
                    weed_labor_23$time_min < lower_bound)

hist(weed_labor_23$time_min)
skewness(weed_labor_23$time_min, na.rm = TRUE)
qqnorm(weed_labor_23$time_min, main='Normal')
qqline(weed_labor_23$time_min)
shapiro.test(weed_labor_23$time_min)

#boxcox
bc <- boxcox(lm(weed_labor_23$time_min ~ 1))
lambda <- bc$x[which.max(bc$y)]
weed_labor_23$bc_time <- (weed_labor_23$time_min ^ lambda -1)/lambda

hist(weed_labor_23$bc_time)
skewness(weed_labor_23$bc_time, na.rm = TRUE)
qqnorm(weed_labor_23$bc_time, main='Normal')
qqline(weed_labor_23$bc_time)
shapiro.test(weed_labor_23$bc_time)

#log
weed_labor_23$log_time <- log10(weed_labor_23$time_min)
hist(weed_labor_23$log_time)
skewness(weed_labor_23$log_time, na.rm = TRUE)
qqnorm(weed_labor_23$log_time, main='Normal')
qqline(weed_labor_23$log_time)
shapiro.test(weed_labor_23$log_time)

```

#### 2024
The original dataset is non-parametric. Lambda is close to 0, indicating boxcox or log would be most appropriate. Only boxcox is successful
```{r}
weed_labor_24 <- subset(weed_labor, year == "2024")

# no outliers when just looking at 2024
Q1 <- quantile(weed_labor_24$time_min, 0.25, na.rm = TRUE) 
Q3 <- quantile(weed_labor_24$time_min, 0.75, na.rm = TRUE) 
IQR <- IQR(weed_labor_24$time_min,na.rm = TRUE)

lower_bound <- Q1 - (1.5*IQR)
upper_bound <- Q3 + (1.5*IQR)

test <- subset(weed_labor_24, weed_labor_24$time_min > upper_bound | 
                    weed_labor_24$time_min < lower_bound)

hist(weed_labor_24$time_min)
skewness(weed_labor_24$time_min, na.rm = TRUE)
qqnorm(weed_labor_24$time_min, main='Normal')
qqline(weed_labor_24$time_min)
shapiro.test(weed_labor_24$time_min)

#boxcox
bc <- boxcox(lm(weed_labor_24$time_min ~ 1))
lambda <- bc$x[which.max(bc$y)]
weed_labor_24$bc_time <- (weed_labor_24$time_min ^ lambda -1)/lambda

hist(weed_labor_24$bc_time)
skewness(weed_labor_24$bc_time, na.rm = TRUE)
qqnorm(weed_labor_24$bc_time, main='Normal')
qqline(weed_labor_24$bc_time)
shapiro.test(weed_labor_24$bc_time)

#log
weed_labor_24$log_time <- log10(weed_labor_24$time_min)
hist(weed_labor_24$log_time)
skewness(weed_labor_24$log_time, na.rm = TRUE)
qqnorm(weed_labor_24$log_time, main='Normal')
qqline(weed_labor_24$log_time)
shapiro.test(weed_labor_24$log_time)

#sqrt
weed_labor_24$sqrt_time <- sqrt(weed_labor_24$time_min)
hist(weed_labor_24$sqrt_time)
skewness(weed_labor_24$sqrt_time, na.rm = TRUE)
qqnorm(weed_labor_24$sqrt_time, main='Normal')
qqline(weed_labor_24$sqrt_time)
shapiro.test(weed_labor_24$sqrt_time)

```


### Overall

```{r}
#This demonstrates treatment, crop, and year have a significant effect, but only treatment year has a significant interaction effect. 
aov <- aov(bc_time ~ treatment*crop*year, data = weed_labor)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# treatment, year, and interactions all significant
aov <- aov(bc_time ~ treatment*year, data = weed_labor)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#LMM: block is not a significant RE
model <- lmer(bc_time ~ treatment*year + (1 | block), data = weed_labor)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

#LMM: weeding point is a significant RE, and so is block in this context
model <- lmer(bc_time ~ treatment*year + (1 | weeding_point/block), data = weed_labor)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```
```{r}
# Using the ANOVA, cardboard mulch is significantly different from bare soil and straw. Straw mulch and bare soil are *nearly* significantly different (0.06). In the KW, all treatments are significantly different from each other
aov <- aov(bc_time ~ treatment, data = weed_labor)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#LMM
model <- lmer(bc_time ~ treatment + (1 | weeding_point/block), data = weed_labor)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```


```{r}

# Across both study years, all treatments are significantly difference
kruskal.test(time_min ~ treatment, weed_labor)
dunnTest(time_min ~ treatment, weed_labor)

# There is a nearly significant difference between DB-FC
kruskal.test(time_min ~ crop, weed_labor)
dunnTest(time_min ~ crop, weed_labor)

# no difference
kruskal.test(time_min ~ crop, subset(weed_labor, treatment == "BM"))
dunnTest(time_min ~ crop, subset(weed_labor, treatment == "BM"))

# no difference
kruskal.test(time_min ~ crop, subset(weed_labor, treatment == "CM"))
dunnTest(time_min ~ crop, subset(weed_labor, treatment == "CM"))

# no difference. nearly significant difference between AS-FC
kruskal.test(time_min ~ crop, subset(weed_labor, treatment == "SM"))
dunnTest(time_min ~ crop, subset(weed_labor, treatment == "SM"))

# But the winner is that there is a significant difference between years
kruskal.test(time_min ~ year, weed_labor) # p < 0.001, so analyzing years separately

```



### 2023


```{r}

#Based on broader results above, I'm analyzing each year separately. 
#ANOVA: Straw is significantly different from BM and CM
aov <- aov(bc_time ~ treatment, data = weed_labor_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#ANOVA: checking for significant differences between crops - there are none
aov <- aov(bc_time ~ treatment*crop, data = weed_labor_23)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# KW: Straw is significantly different from BM and CM
kruskal.test(time_min ~ treatment, data = weed_labor_23)
dunnTest(time_min ~ treatment, data = weed_labor_23)

# LMM: weeding point is a significant RE 
model <- lmer(bc_time ~ treatment + (1 | weeding_point), data = weed_labor_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

# LMM: only weeding point is a significant RE 
model <- lmer(bc_time ~ treatment + (1 | weeding_point/block), data = weed_labor_23)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```



##### Weeding Day 1

Straw mulch is significantly different from cardboard and bare soil. Cardboard is nearly significantly different (0.05). KW test shows slightly different results; only straw mulch and cardboard mulch are significantly different

```{r}
#ANOVA: significant difference between SM and BM/CM. A very nearly significant difference between BM/CM as well.
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_23, weeding_point == "1"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: only significant difference is SM-CM, but the others are close to being significant
kruskal.test(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "1"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "1"))

#LMM: block is not a significant RE
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_23, weeding_point == "1"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)
```

##### Weeding Day 2

Straw mulch is significantly different from cardboard and bare soil.

```{r}
#ANOVA: significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_23, weeding_point == "2"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: significant difference between SM and BM/CM. 
kruskal.test(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "2"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "2"))

#LMM: block is not a significant RE
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_23, weeding_point == "2"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

##### Weeding Day 3

```{r}
#ANOVA: significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_23, weeding_point == "3"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: significant difference between SM and BM/CM. 
kruskal.test(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "3"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "3"))

#LMM: isSingular error
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_23, weeding_point == "3"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

##### Weeding Day 4

According to the ANOVA, all mulches are signifcantly different from each other. According to the KW, only straw mulch and cardboard mulch are significantly different (though the others are close)

```{r}

#ANOVA: significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_23, weeding_point == "4"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: significant difference between SM and BM/CM. 
kruskal.test(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "4"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_23, weeding_point == "4"))

#LMM: isSingular error
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_23, weeding_point == "4"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

### 2024

note that I did check each weeding day for interactions with crop. I also ran LMMs for each weeding day with block as the random effect; it did not significantly improve the model.

```{r}

#Based on broader results above, I'm analyzing each year separately. 
#ANOVA: cardboard is significantly different from BM and SM
aov <- aov(bc_time ~ treatment, data = weed_labor_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#ANOVA: checking for significant differences between crops - there are none
aov <- aov(bc_time ~ treatment*crop, data = weed_labor_24)
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

# KW: Straw is significantly different from BM and CM
kruskal.test(time_min ~ treatment, data = weed_labor_24)
dunnTest(time_min ~ treatment, data = weed_labor_24)

# LMM: weeding point is a significant RE 
model <- lmer(bc_time ~ treatment + (1 | weeding_point), data = weed_labor_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

# LMM: only weeding point is a significant RE 
model <- lmer(bc_time ~ treatment + (1 | weeding_point/block), data = weed_labor_24)
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)



```

##### Weeding Day 1

No significant difference between mulch treatments

```{r}
#ANOVA: no differences
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_24, weeding_point == "1"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: no differences
kruskal.test(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "1"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "1"))

#LMM: block is not a significant RE
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_24, weeding_point == "1"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

##### Weeding Day 2

```{r}
#ANOVA: significant difference between BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_24, weeding_point == "2"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: significant difference between BM/CM. 
kruskal.test(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "2"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "2"))

#LMM: block is a significant RE. also a sig dif between CM-SM
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_24, weeding_point == "2"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

##### Weeding Day 3

```{r}
#ANOVA: no differences. nearly significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_24, weeding_point == "3"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: no differences. near significant difference between SM and BM/CM. 
kruskal.test(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "3"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "3"))

#LMM: block is not a significant RE
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_24, weeding_point == "3"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

##### Weeding Day 4

```{r}
#ANOVA: significant difference between SM and BM/CM. 
aov <- aov(bc_time ~ treatment, data = subset(weed_labor_24, weeding_point == "4"))
summary(aov)
TukeyHSD(aov)
AIC(aov)
plot(aov)

#KW: significant difference between SM and BM/CM. 
kruskal.test(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "4"))
dunnTest(time_min ~ treatment, data = subset(weed_labor_24, weeding_point == "4"))

#LMM: isSingular error
model <- lmer(bc_time ~ treatment + (1 | block), data = subset(weed_labor_24, weeding_point == "4"))
AIC(model)
summary(model)

#extract random effects and residual values
re <- ranef(model)
resid <- augment(model)

#generate qqplot
plot(re)

#generate plot of fitted vs. residual values
ggplot(resid, aes(x = .fitted, y = .resid)) + geom_point() + stat_smooth(se = F)

#ranked likelihood test
ranova(model)

emmeans(model, pairwise ~ treatment)

```

